# å‰ç«¯æ¶æ„é—®é¢˜ä¿®å¤æŒ‡å—

## ğŸ¯ 3æ­¥å®Œå…¨é‡æ„æ–¹æ¡ˆ

### æ ¸å¿ƒé—®é¢˜æ¦‚æ‹¬

```
å½“å‰çŠ¶æ€                          ç›®æ ‡çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pages/ (20æ–‡ä»¶)                âŒ åˆ é™¤
â”œâ”€ Auth/                       
â”œâ”€ Book/                       
â”œâ”€ Bookstore/                  
â”œâ”€ Reader/                     
â”œâ”€ User/                       
â””â”€ Writer/                     

modules/*/routes.ts (5ä¸ª)      âœ… æ•´åˆä¸ºå•ä¸€çœŸå®æº
modules/*/views/ (å®Œæ•´)        âœ… ä¿ç•™å¹¶ä½¿ç”¨
modules/*/api/                 âŒ åˆ é™¤ï¼ˆä½¿ç”¨ /api/ï¼‰

router/index.ts (æ··ä¹±)         âœ… ç®€åŒ–ä¸ºèšåˆå™¨
â”œâ”€ æ··åˆå®šä¹‰æ‰€æœ‰è·¯ç”±
â”œâ”€ æ··ä¹±çš„å‘½åè§„èŒƒ
â””â”€ å¯¼å…¥ pages/ ç»„ä»¶            æ”¹ä¸ºå¯¼å…¥ modules/*/views/
```

---

## ğŸ“‹ ä¿®å¤æ­¥éª¤

### Step 1: å‡†å¤‡å·¥ä½œï¼ˆ5åˆ†é’Ÿï¼‰

#### 1.1 åˆ›å»ºæ–°çš„è·¯ç”±ç»“æ„

åˆ›å»º `src/router/auth-routes.ts`ï¼š

```typescript
import type { RouteRecordRaw } from 'vue-router'

export const authRoutes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'login',
    component: () => import('@/modules/user/views/AuthenticationView.vue'),
    meta: { requiresAuth: false, title: 'ç™»å½•' },
  },
  {
    path: '/register',
    name: 'register',
    component: () => import('@/modules/user/views/AuthenticationView.vue'),
    meta: { requiresAuth: false, title: 'æ³¨å†Œ' },
  },
]
```

åˆ›å»º `src/router/error-routes.ts`ï¼š

```typescript
import type { RouteRecordRaw } from 'vue-router'

export const errorRoutes: RouteRecordRaw[] = [
  {
    path: '/:pathMatch(.*)*',
    name: 'not-found',
    component: () => import('@/shared/components/layout/NotFound.vue'),
    meta: { title: 'é¡µé¢ä¸å­˜åœ¨' },
  },
]
```

#### 1.2 æ£€æŸ¥æ¨¡å—è·¯ç”±å®Œæ•´æ€§

ç¡®è®¤ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ï¼š
- âœ… `modules/bookstore/routes.ts`
- âœ… `modules/reader/routes.ts`
- âœ… `modules/user/routes.ts`
- âœ… `modules/writer/routes.ts`
- âœ… `modules/admin/routes.ts`

### Step 2: ç»Ÿä¸€è·¯ç”±å®šä¹‰ï¼ˆ15åˆ†é’Ÿï¼‰

#### 2.1 æ›´æ–°ä¸»è·¯ç”±æ–‡ä»¶

æ›¿æ¢ `src/router/index.ts`ï¼š

```typescript
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'
import { useUserStore } from '@/stores/user'

// å¯¼å…¥æ¨¡å—è·¯ç”±
import { authRoutes } from './auth-routes'
import { errorRoutes } from './error-routes'
import bookstoreRoutes from '@/modules/bookstore/routes'
import readerRoutes from '@/modules/reader/routes'
import userRoutes from '@/modules/user/routes'
import writerRoutes from '@/modules/writer/routes'
import adminRoutes from '@/modules/admin/routes'

// èšåˆæ‰€æœ‰è·¯ç”±
const routes: RouteRecordRaw[] = [
  { path: '/', redirect: '/bookstore' },  // é»˜è®¤é‡å®šå‘
  ...authRoutes,
  ...bookstoreRoutes,
  ...readerRoutes,
  ...userRoutes,
  ...writerRoutes,
  ...adminRoutes,
  ...errorRoutes,
]

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes,
  scrollBehavior(to, from, savedPosition) {
    if (savedPosition) return savedPosition
    else return { top: 0 }
  },
})

// å…¨å±€å‰ç½®å®ˆå«
router.beforeEach((to, from, next) => {
  const userStore = useUserStore()

  // è®¾ç½®é¡µé¢æ ‡é¢˜
  if (to.meta.title) {
    document.title = `${to.meta.title} - é’ç¾½å†™ä½œå¹³å°`
  }

  // æ£€æŸ¥è®¤è¯
  if (to.meta.requiresAuth && !userStore.isLoggedIn) {
    next({
      path: '/login',
      query: { redirect: to.fullPath },
    })
    return
  }

  // æ£€æŸ¥å†™ä½œæƒé™
  if (to.meta.requiresWriter && !userStore.isWriter) {
    next({
      path: '/bookstore',
      query: { message: 'éœ€è¦å†™ä½œæƒé™' },
    })
    return
  }

  // å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µé‡å®šå‘
  if ((to.path === '/login' || to.path === '/register') && userStore.isLoggedIn) {
    next({ path: '/bookstore' })
    return
  }

  next()
})

export default router
```

#### 2.2 ç»Ÿä¸€å‘½åè§„èŒƒ

æ£€æŸ¥æ‰€æœ‰è·¯ç”±åï¼Œç¡®ä¿ä½¿ç”¨ kebab-caseï¼š

```typescript
âŒ æ—§è§„èŒƒ
{
  path: '/bookstore',
  name: 'Bookstore',          // PascalCase
}

âœ… æ–°è§„èŒƒ
{
  path: '/bookstore',
  name: 'bookstore',          // kebab-case
}
```

æ›´æ–°æ£€æŸ¥æ¸…å•ï¼š
- [ ] `router/index.ts` - åç§°ç»Ÿä¸€ä¸º kebab-case
- [ ] `modules/bookstore/routes.ts` - æ£€æŸ¥å‘½å
- [ ] `modules/reader/routes.ts` - æ£€æŸ¥å‘½å
- [ ] `modules/user/routes.ts` - æ£€æŸ¥å‘½å
- [ ] `modules/writer/routes.ts` - æ£€æŸ¥å‘½å
- [ ] `modules/admin/routes.ts` - æ£€æŸ¥å‘½å

### Step 3: æ¸…ç†æ¨¡å—ç»“æ„ï¼ˆ30åˆ†é’Ÿï¼‰

#### 3.1 åˆ é™¤è¿‡æ—¶çš„æ¨¡å— API

```bash
# åˆ é™¤æ‰€æœ‰æ¨¡å—çº§ API
âŒ modules/bookstore/api/
âŒ modules/reader/api/
âŒ modules/user/api/
âŒ modules/writer/api/  (å…¨éƒ¨10ä¸ªæ–‡ä»¶)
âŒ modules/admin/api/
```

#### 3.2 æ›´æ–°æ¨¡å—å†…çš„ API å¯¼å…¥

**æ›´æ–°** `modules/bookstore/services/bookstore.service.ts`ï¼š

```typescript
// âŒ æ—§å¯¼å…¥
import { bookstoreAPI } from '../api/bookstore.api'

// âœ… æ–°å¯¼å…¥
import * as bookstoreAPI from '@/api/bookstore'

// æˆ–æ›´ç²¾ç¡®çš„å¯¼å…¥
import {
  getHomepage,
  getBookDetail,
  getCategoryTree,
  getBanners,
  getRankingByType,
} from '@/api/bookstore'
```

ç±»ä¼¼åœ°æ›´æ–°ï¼š
- [ ] `modules/reader/services/` ä¸­çš„å¯¼å…¥ â†’ `@/api/reading/`
- [ ] `modules/user/services/` ä¸­çš„å¯¼å…¥ â†’ `@/api/user/` å’Œ `@/api/shared/`
- [ ] `modules/writer/` ä¸­çš„å¯¼å…¥ â†’ `@/api/writing/`
- [ ] `modules/admin/services/` ä¸­çš„å¯¼å…¥ â†’ `@/api/shared/admin`

#### 3.3 åˆ é™¤ pages ç›®å½•

```bash
# âŒ åˆ é™¤æ•´ä¸ª pages ç›®å½•
rm -rf src/pages/

# éªŒè¯ï¼šæ‰€æœ‰é¡µé¢æ–‡ä»¶åº”å·²åœ¨ modules/*/views/ ä¸­
# ä¾‹å¦‚ï¼špages/Bookstore/Home.vue â†’ modules/bookstore/views/HomeView.vue
```

**å¤‡ä»½æ¸…å•**ï¼ˆç¡®è®¤è¿™äº›æ–‡ä»¶å·²åœ¨ modules ä¸­ï¼‰ï¼š
- [ ] `pages/Auth/Login.vue` â†’ `modules/user/views/AuthenticationView.vue`
- [ ] `pages/Auth/Register.vue` â†’ `modules/user/views/AuthenticationView.vue`
- [ ] `pages/Book/Detail.vue` â†’ `modules/bookstore/views/BookDetailView.vue`
- [ ] `pages/Bookstore/Home.vue` â†’ `modules/bookstore/views/HomeView.vue`
- [ ] `pages/Bookstore/Category.vue` â†’ `modules/bookstore/views/CategoriesView.vue`
- [ ] `pages/Bookstore/Search.vue` â†’ `modules/bookstore/views/SearchView.vue`
- [ ] `pages/Reader/Index.vue` â†’ `modules/reader/views/ReaderView.vue`
- [ ] `pages/User/Profile.vue` â†’ `modules/user/views/ProfileView.vue`
- [ ] `pages/User/ReadingHistory.vue` â†’ `modules/reader/views/ReadingHistoryView.vue`
- [ ] `pages/Wallet/Index.vue` â†’ `modules/user/views/WalletView.vue`
- [ ] `pages/Writer/` â†’ `modules/writer/views/`

#### 3.4 æ¸…ç†å¤‡ä»½å’Œä¸´æ—¶æ–‡ä»¶

```bash
âŒ modules/user/views/ProfileView_BACKUP.vue

# åˆ é™¤åéªŒè¯ï¼š
git status  # ç¡®è®¤åˆ é™¤
```

#### 3.5 æ•´ç† components ç›®å½•

```bash
# åˆ†æ components/ ä¸­çš„æ¯ä¸ªæ–‡ä»¶å¤¹
src/components/
â”œâ”€â”€ admin/           # å±äº modules/admin/components/
â”œâ”€â”€ Book/            # å±äº modules/bookstore/components/
â”œâ”€â”€ bookstore/       # å±äº modules/bookstore/components/
â”œâ”€â”€ Category/        # å±äº modules/bookstore/components/
â”œâ”€â”€ common/          # éƒ¨åˆ†å¯èƒ½å±äº shared/components/
â”œâ”€â”€ Layout/          # å±äº shared/components/layout/
â”œâ”€â”€ Ranking/         # å±äº modules/bookstore/components/
â””â”€â”€ reading/         # å±äº modules/reader/components/

# ç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®åï¼Œåˆ é™¤ components/ ç›®å½•
rm -rf src/components/
```

### Step 4: éªŒè¯å’Œæµ‹è¯•ï¼ˆ20åˆ†é’Ÿï¼‰

#### 4.1 æ£€æŸ¥è·¯ç”±å¯¼èˆª

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# éªŒè¯æ¸…å•
- [ ] è®¿é—® http://localhost:5173/bookstore - æ­£å¸¸
- [ ] è®¿é—® http://localhost:5173/login - æ­£å¸¸
- [ ] è®¿é—® http://localhost:5173/reader/... - æ­£å¸¸
- [ ] è®¿é—® http://localhost:5173/writer/... - éœ€è¦ç™»å½•
- [ ] è®¿é—® http://localhost:5173/admin - éœ€è¦ç®¡ç†å‘˜æƒé™
- [ ] è®¿é—® http://localhost:5173/invalid-path - æ˜¾ç¤º404
```

#### 4.2 æ£€æŸ¥æ§åˆ¶å°é”™è¯¯

```bash
# å¼€å‘å·¥å…· F12 æ£€æŸ¥ï¼š
- [ ] æ— 404é”™è¯¯
- [ ] æ— è·¯ç”±è­¦å‘Š
- [ ] æ— å¯¼å…¥é”™è¯¯
```

#### 4.3 æ£€æŸ¥ç±»å‹é”™è¯¯

```bash
# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check  # æˆ– npx tsc --noEmit

# éªŒè¯ï¼š
- [ ] æ—  TypeScript é”™è¯¯
- [ ] æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®
```

#### 4.4 ç”Ÿäº§æ„å»ºéªŒè¯

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# éªŒè¯ï¼š
- [ ] æ„å»ºæˆåŠŸå®Œæˆ
- [ ] dist/ ç›®å½•ç”Ÿæˆ
- [ ] æ²¡æœ‰æœªä½¿ç”¨ä»£ç è­¦å‘Š
```

---

## ğŸ”„ æ–‡ä»¶è¿ç§»æ£€æŸ¥è¡¨

### æ¥è‡ª pages çš„æ–‡ä»¶éœ€è¦æ£€æŸ¥

```
pages/Auth/
  â”œâ”€ Login.vue                     â†’ modules/user/views/ (éªŒè¯)
  â””â”€ Register.vue                  â†’ modules/user/views/ (éªŒè¯)

pages/Book/
  â””â”€ Detail.vue                    â†’ modules/bookstore/views/ (éªŒè¯)

pages/Bookstore/
  â”œâ”€ Home.vue                      â†’ modules/bookstore/views/HomeView.vue
  â”œâ”€ Category.vue                  â†’ modules/bookstore/views/CategoriesView.vue
  â””â”€ Search.vue                    â†’ modules/bookstore/views/SearchView.vue

pages/Reader/
  â””â”€ Index.vue                     â†’ modules/reader/views/ReaderView.vue

pages/User/
  â”œâ”€ Profile.vue                   â†’ modules/user/views/ProfileView.vue
  â””â”€ ReadingHistory.vue            â†’ modules/reader/views/ReadingHistoryView.vue

pages/Wallet/
  â””â”€ Index.vue                     â†’ modules/user/views/WalletView.vue

pages/Writer/
  â”œâ”€ Editor.vue                    â†’ modules/writer/views/EditorView.vue
  â”œâ”€ ProjectList.vue               â†’ modules/writer/views/ProjectListView.vue
  â”œâ”€ ProjectDetail.vue             â†’ modules/writer/views/ProjectWorkspace.vue
  â””â”€ Statistics.vue                â†’ modules/writer/views/StatisticsView.vue

pages/Error/
  â””â”€ NotFound.vue                  â†’ shared/components/layout/ (æˆ–åˆ›å»º)
```

### éœ€è¦æ›´æ–°çš„å¯¼å…¥è·¯å¾„

```typescript
// âŒ æ—§å¯¼å…¥ï¼ˆæ¥è‡ª pagesï¼‰
import Home from '@/pages/Bookstore/Home.vue'
import Login from '@/pages/Auth/Login.vue'
import Reader from '@/pages/Reader/Index.vue'

// âœ… æ–°å¯¼å…¥ï¼ˆæ¥è‡ª modulesï¼‰
import Home from '@/modules/bookstore/views/HomeView.vue'
import Login from '@/modules/user/views/AuthenticationView.vue'
import Reader from '@/modules/reader/views/ReaderView.vue'
```

---

## ğŸ¨ æœ€ç»ˆæ¶æ„éªŒè¯

å®Œæˆåçš„æ¶æ„åº”è¯¥æ˜¯ï¼š

```
src/
â”œâ”€â”€ api/                        âœ… æ¨¡å—åŒ– API
â”‚   â”œâ”€â”€ bookstore/
â”‚   â”œâ”€â”€ reading/
â”‚   â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ user/
â”‚   â”œâ”€â”€ writing/
â”‚   â””â”€â”€ recommendation/
â”‚
â”œâ”€â”€ modules/                    âœ… åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ bookstore/
â”‚   â”‚   â”œâ”€â”€ routes.ts           âœ… å”¯ä¸€çš„è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ views/              âœ… æ‰€æœ‰é¡µé¢åœ¨è¿™é‡Œ
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”œâ”€â”€ reader/                 âœ… æ ¼å¼ç›¸åŒ
â”‚   â”œâ”€â”€ user/                   âœ… æ ¼å¼ç›¸åŒ
â”‚   â”œâ”€â”€ writer/                 âœ… æ ¼å¼ç›¸åŒ
â”‚   â””â”€â”€ shared/                 âœ… å…±äº«æ¨¡å—
â”‚
â”œâ”€â”€ router/                     âœ… ç®€åŒ–çš„èšåˆå™¨
â”‚   â”œâ”€â”€ index.ts               (åªèšåˆå­è·¯ç”±)
â”‚   â”œâ”€â”€ auth-routes.ts
â”‚   â””â”€â”€ error-routes.ts
â”‚
â”œâ”€â”€ shared/                     âœ… çœŸæ­£å…±äº«çš„èµ„æº
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ composables/
â”‚   â””â”€â”€ types/
â”‚
â”œâ”€â”€ stores/                     âœ… å…¨å±€çŠ¶æ€
â”œâ”€â”€ composables/                âœ… å…¨å±€ç»„åˆå‡½æ•°
â”œâ”€â”€ directives/                 âœ… è‡ªå®šä¹‰æŒ‡ä»¤
â”œâ”€â”€ types/                      âœ… å…¨å±€ç±»å‹
â”œâ”€â”€ utils/                      âœ… å·¥å…·å‡½æ•°
â””â”€â”€ styles/                     âœ… å…¨å±€æ ·å¼

âŒ ä¸åº”è¯¥å­˜åœ¨ï¼š
  - pages/ ç›®å½•
  - modules/*/api/ ç›®å½•
  - components/ ç›®å½•
```

---

## â±ï¸ é¢„è®¡å·¥ä½œé‡

| ä»»åŠ¡ | æ—¶é—´ | ä¼˜å…ˆçº§ |
|------|------|-------|
| å‡†å¤‡å·¥ä½œ | 5åˆ†é’Ÿ | P0 |
| ç»Ÿä¸€è·¯ç”± | 15åˆ†é’Ÿ | P0 |
| æ¸…ç†æ¨¡å— | 30åˆ†é’Ÿ | P0 |
| éªŒè¯æµ‹è¯• | 20åˆ†é’Ÿ | P0 |
| **æ€»è®¡** | **70åˆ†é’Ÿ** | **P0** |

---

## ğŸ’¡ å¸¸è§é—®é¢˜è§£å†³

### Q1: æˆ‘å¦‚ä½•ç¡®ä¿æ²¡æœ‰é—æ¼æ–‡ä»¶ï¼Ÿ

```bash
# ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
diff -r src/pages/ src/modules/*/views/

# ç¡®è®¤æ‰€æœ‰ pages æ–‡ä»¶åœ¨ modules ä¸­éƒ½æœ‰å¯¹åº”
```

### Q2: è·¯ç”±å¯¼å…¥é”™è¯¯ï¼Ÿ

```bash
# æ£€æŸ¥å¯¼å…¥è·¯å¾„
grep -r "from '@/pages/" src/

# åº”è¯¥æ›¿æ¢ä¸º
grep -r "from '@/modules/" src/router/
```

### Q3: æ¨¡å— API è°ƒç”¨å¤±è´¥ï¼Ÿ

```bash
# æ£€æŸ¥ API å¯¼å…¥
grep -r "api/" src/modules/*/services/

# åº”è¯¥ä½¿ç”¨
grep -r "@/api/" src/modules/*/services/
```

---

**ä¿®å¤æŒ‡å—å®Œæˆ** - æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æ‰§è¡Œï¼Œé¢„è®¡ 70 åˆ†é’Ÿå†…å®Œæˆå‰ç«¯æ¶æ„å®Œå…¨é‡æ„ï¼
