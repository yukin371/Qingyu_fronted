# é’ç¾½åç«¯ API å‰ç«¯é›†æˆæŒ‡å—

> **ç‰ˆæœ¬**: v1.3 â­ï¸å·²æ›´æ–°  
> **æœ€åæ›´æ–°**: 2025-10-25  
> **é€‚ç”¨å¯¹è±¡**: å‰ç«¯å¼€å‘è€…  
> **ä¸»è¦æ›´æ–°**: ç»Ÿä¸€å“åº”æ ¼å¼ã€è¯„è®ºç‚¹èµåŠŸèƒ½ã€é”™è¯¯è¿½è¸ª

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è®¤è¯æµç¨‹](#è®¤è¯æµç¨‹)
- [ç»Ÿä¸€è¯·æ±‚å°è£…](#ç»Ÿä¸€è¯·æ±‚å°è£…)
- [æ ¸å¿ƒåŠŸèƒ½é›†æˆ](#æ ¸å¿ƒåŠŸèƒ½é›†æˆ)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

#### API åŸºç¡€ URL

```javascript
// å¼€å‘ç¯å¢ƒ
const API_BASE_URL = 'http://localhost:8080/api/v1';

// ç”Ÿäº§ç¯å¢ƒ
const API_BASE_URL = 'https://api.qingyu.com/api/v1';
```

#### æ¨èé…ç½®æ–¹å¼

**ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

```javascript
// .env.development
VITE_API_BASE_URL=http://localhost:8080/api/v1

// .env.production
VITE_API_BASE_URL=https://api.qingyu.com/api/v1
```

```javascript
// config/api.js
export const API_BASE_URL = import.meta.env.VITE_API_BASE_URL;
```

### 2. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ axios ä½œä¸ºHTTPå®¢æˆ·ç«¯
npm install axios

# æˆ–ä½¿ç”¨ yarn
yarn add axios
```

---

## è®¤è¯æµç¨‹

### Token è·å–ä¸å­˜å‚¨

é’ç¾½åç«¯ä½¿ç”¨ **JWT Token** è¿›è¡Œèº«ä»½è®¤è¯ã€‚

#### ç™»å½•è·å– Token

```javascript
// api/auth.js
import axios from 'axios';
import { API_BASE_URL } from './config';

export async function login(username, password) {
  const response = await axios.post(`${API_BASE_URL}/login`, {
    username,
    password
  });
  
  const { token, userID, username: userName } = response.data.data;
  
  // å­˜å‚¨ Token
  localStorage.setItem('token', token);
  localStorage.setItem('userId', userID);
  localStorage.setItem('username', userName);
  
  return response.data;
}
```

#### Token å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”

| å­˜å‚¨æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåœºæ™¯ |
|---------|------|------|---------|
| localStorage | ç®€å•æ˜“ç”¨ï¼Œæ°¸ä¹…å­˜å‚¨ | å®¹æ˜“å—XSSæ”»å‡» | ä¸€èˆ¬åº”ç”¨ |
| sessionStorage | å…³é—­æµè§ˆå™¨è‡ªåŠ¨æ¸…é™¤ | å¤šæ ‡ç­¾é¡µä¸å…±äº« | é«˜å®‰å…¨è¦æ±‚ |
| Cookie (httpOnly) | é˜²XSSï¼Œè‡ªåŠ¨å‘é€ | é…ç½®å¤æ‚ï¼Œå—CSRFå½±å“ | ä¼ä¸šçº§åº”ç”¨ |
| å†…å­˜å­˜å‚¨ | æœ€å®‰å…¨ | åˆ·æ–°é¡µé¢ä¸¢å¤± | æé«˜å®‰å…¨è¦æ±‚ |

**æ¨èæ–¹æ¡ˆ**ï¼šlocalStorage + Tokenè¿‡æœŸè‡ªåŠ¨åˆ·æ–°

### Token ä½¿ç”¨

#### åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ Token

```javascript
axios.get(`${API_BASE_URL}/users/profile`, {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
});
```

### Token åˆ·æ–°

```javascript
export async function refreshToken() {
  const oldToken = localStorage.getItem('token');
  
  try {
    const response = await axios.post(
      `${API_BASE_URL}/shared/auth/refresh`,
      {},
      {
        headers: {
          'Authorization': `Bearer ${oldToken}`
        }
      }
    );
    
    const { token: newToken } = response.data.data;
    localStorage.setItem('token', newToken);
    
    return newToken;
  } catch (error) {
    // Token åˆ·æ–°å¤±è´¥ï¼Œéœ€è¦é‡æ–°ç™»å½•
    logout();
    window.location.href = '/login';
    throw error;
  }
}
```

### é€€å‡ºç™»å½•

```javascript
export async function logout() {
  const token = localStorage.getItem('token');
  
  try {
    await axios.post(
      `${API_BASE_URL}/shared/auth/logout`,
      {},
      {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    );
  } catch (error) {
    console.error('ç™»å‡ºå¤±è´¥:', error);
  } finally {
    // æ¸…é™¤æœ¬åœ°å­˜å‚¨
    localStorage.removeItem('token');
    localStorage.removeItem('userId');
    localStorage.removeItem('username');
  }
}
```

---

## ç»Ÿä¸€è¯·æ±‚å°è£…

### Axios å®ä¾‹é…ç½®

åˆ›å»ºç»Ÿä¸€çš„ HTTP å®¢æˆ·ç«¯å®ä¾‹ï¼š

```javascript
// utils/request.js
import axios from 'axios';
import { API_BASE_URL } from '../config/api';
import { refreshToken } from '../api/auth';

// åˆ›å»º axios å®ä¾‹
const request = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  config => {
    // æ·»åŠ  Token
    const token = localStorage.getItem('token');
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`;
    }
    
    // æ·»åŠ è¯·æ±‚æ—¶é—´æˆ³ï¼ˆé˜²æ­¢ç¼“å­˜ï¼‰
    if (config.method === 'get') {
      config.params = {
        ...config.params,
        _t: Date.now()
      };
    }
    
    // æ˜¾ç¤º Loading
    showLoading();
    
    return config;
  },
  error => {
    hideLoading();
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨ â­ï¸å·²æ›´æ–°
request.interceptors.response.use(
  response => {
    hideLoading();
    
    // ç»Ÿä¸€å¤„ç†å“åº”æ•°æ®ï¼ˆæ–°å¢ timestamp å’Œ request_idï¼‰
    const { code, message, data, timestamp, request_id } = response.data;
    
    // è®°å½•è¯·æ±‚IDä¾¿äºè¿½è¸ªï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    if (request_id && process.env.NODE_ENV === 'development') {
      console.debug('Request ID:', request_id, 'Time:', new Date(timestamp * 1000).toISOString());
    }
    
    if (code === 200 || code === 201) {
      return data;
    } else {
      // ä¸šåŠ¡é”™è¯¯
      showError(message);
      return Promise.reject(new Error(message));
    }
  },
  async error => {
    hideLoading();
    
    if (!error.response) {
      // ç½‘ç»œé”™è¯¯
      showError('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
      return Promise.reject(error);
    }
    
    const { status } = error.response;
    const { request_id, error: errorDetail } = error.response.data || {};
    
    // è®°å½•é”™è¯¯è¿½è¸ªID
    if (request_id) {
      console.error('Error Request ID:', request_id, 'Detail:', errorDetail);
    }
    
    switch (status) {
      case 401:
        // Token è¿‡æœŸæˆ–æ— æ•ˆ
        try {
          // å°è¯•åˆ·æ–° Token
          await refreshToken();
          // é‡è¯•åŸè¯·æ±‚
          return request(error.config);
        } catch (refreshError) {
          // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•é¡µ
          showError('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
          setTimeout(() => {
            window.location.href = '/login';
          }, 1500);
        }
        break;
        
      case 403:
        showError('æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº');
        break;
        
      case 404:
        showError('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨');
        break;
        
      case 500:
        showError('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
        break;
        
      default:
        showError(error.response.data?.message || 'è¯·æ±‚å¤±è´¥');
    }
    
    return Promise.reject(error);
  }
);

// Loading çŠ¶æ€ç®¡ç†
let loadingCount = 0;
function showLoading() {
  loadingCount++;
  // æ˜¾ç¤º Loading ç»„ä»¶
  // ä¾‹å¦‚ï¼šElLoading.service()
}

function hideLoading() {
  loadingCount--;
  if (loadingCount <= 0) {
    loadingCount = 0;
    // éšè— Loading ç»„ä»¶
  }
}

function showError(message) {
  // æ˜¾ç¤ºé”™è¯¯æç¤º
  // ä¾‹å¦‚ï¼šElMessage.error(message)
  console.error(message);
}

export default request;
```

### ä½¿ç”¨å°è£…åçš„è¯·æ±‚

```javascript
// api/user.js
import request from '../utils/request';

// è·å–ç”¨æˆ·ä¿¡æ¯
export function getUserProfile() {
  return request({
    url: '/users/profile',
    method: 'get'
  });
}

// æ›´æ–°ç”¨æˆ·ä¿¡æ¯
export function updateUserProfile(data) {
  return request({
    url: '/users/profile',
    method: 'put',
    data
  });
}
```

---

## æ ¸å¿ƒåŠŸèƒ½é›†æˆ

### ç”¨æˆ·ç³»ç»Ÿé›†æˆ

#### æ³¨å†Œæµç¨‹

```javascript
// components/Register.vue
<script setup>
import { ref } from 'vue';
import { register } from '@/api/auth';
import { useRouter } from 'vue-router';

const router = useRouter();
const form = ref({
  username: '',
  email: '',
  password: '',
  confirmPassword: ''
});

const handleRegister = async () => {
  // è¡¨å•éªŒè¯
  if (form.value.password !== form.value.confirmPassword) {
    alert('ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´');
    return;
  }
  
  try {
    const result = await register({
      username: form.value.username,
      email: form.value.email,
      password: form.value.password
    });
    
    alert('æ³¨å†ŒæˆåŠŸï¼');
    router.push('/login');
  } catch (error) {
    console.error('æ³¨å†Œå¤±è´¥:', error);
  }
};
</script>
```

#### ç™»å½•æµç¨‹

```javascript
// components/Login.vue
<script setup>
import { ref } from 'vue';
import { login } from '@/api/auth';
import { useRouter } from 'vue-router';
import { useUserStore } from '@/stores/user';

const router = useRouter();
const userStore = useUserStore();

const form = ref({
  username: '',
  password: ''
});

const handleLogin = async () => {
  try {
    const result = await login(
      form.value.username,
      form.value.password
    );
    
    // æ›´æ–°ç”¨æˆ·çŠ¶æ€
    userStore.setUser(result.data);
    
    // è·³è½¬åˆ°é¦–é¡µ
    router.push('/');
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error);
  }
};
</script>
```

#### ä¸ªäººä¿¡æ¯ç®¡ç†

```javascript
// api/user.js
export function getUserProfile() {
  return request.get('/users/profile');
}

export function updateUserProfile(data) {
  return request.put('/users/profile', data);
}

export function changePassword(oldPassword, newPassword) {
  return request.put('/users/password', {
    oldPassword,
    newPassword
  });
}
```

```javascript
// pages/Profile.vue
<script setup>
import { ref, onMounted } from 'vue';
import { getUserProfile, updateUserProfile } from '@/api/user';

const profile = ref({});
const loading = ref(false);

onMounted(async () => {
  loading.value = true;
  try {
    profile.value = await getUserProfile();
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
});

const handleUpdate = async () => {
  try {
    await updateUserProfile({
      nickname: profile.value.nickname,
      bio: profile.value.bio,
      avatar: profile.value.avatar
    });
    
    alert('æ›´æ–°æˆåŠŸï¼');
  } catch (error) {
    console.error('æ›´æ–°å¤±è´¥:', error);
  }
};
</script>
```

### ä¹¦åŸç³»ç»Ÿé›†æˆ

#### é¦–é¡µæ•°æ®å±•ç¤º

```javascript
// api/bookstore.js
export function getHomepageData() {
  return request.get('/bookstore/homepage');
}

export function getBookList(params) {
  return request.get('/bookstore/books', { params });
}

export function getBookDetail(bookId) {
  return request.get(`/bookstore/books/${bookId}`);
}

export function searchBooks(keyword, params) {
  return request.get('/bookstore/books/search', {
    params: { keyword, ...params }
  });
}
```

```javascript
// pages/Home.vue
<script setup>
import { ref, onMounted } from 'vue';
import { getHomepageData } from '@/api/bookstore';

const homepageData = ref({
  banners: [],
  recommendedBooks: [],
  featuredBooks: [],
  categories: []
});

onMounted(async () => {
  try {
    homepageData.value = await getHomepageData();
  } catch (error) {
    console.error('è·å–é¦–é¡µæ•°æ®å¤±è´¥:', error);
  }
});
</script>

<template>
  <div class="homepage">
    <!-- Banner è½®æ’­ -->
    <div class="banners">
      <div v-for="banner in homepageData.banners" :key="banner.id">
        <img :src="banner.imageUrl" :alt="banner.title" />
      </div>
    </div>
    
    <!-- æ¨èä¹¦ç± -->
    <div class="recommended-books">
      <h2>æ¨èé˜…è¯»</h2>
      <div class="book-list">
        <div v-for="book in homepageData.recommendedBooks" :key="book.id" class="book-item">
          <img :src="book.coverUrl" :alt="book.title" />
          <h3>{{ book.title }}</h3>
          <p>{{ book.author }}</p>
        </div>
      </div>
    </div>
  </div>
</template>
```

#### ä¹¦ç±è¯¦æƒ…é¡µ

```javascript
// pages/BookDetail.vue
<script setup>
import { ref, onMounted } from 'vue';
import { useRoute } from 'vue-router';
import { getBookDetail } from '@/api/bookstore';

const route = useRoute();
const book = ref(null);
const loading = ref(false);

onMounted(async () => {
  loading.value = true;
  try {
    const bookId = route.params.id;
    book.value = await getBookDetail(bookId);
  } catch (error) {
    console.error('è·å–ä¹¦ç±è¯¦æƒ…å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
});
</script>

<template>
  <div v-if="book" class="book-detail">
    <img :src="book.coverUrl" :alt="book.title" class="cover" />
    <h1>{{ book.title }}</h1>
    <p class="author">ä½œè€…ï¼š{{ book.author }}</p>
    <p class="description">{{ book.description }}</p>
    <div class="stats">
      <span>é˜…è¯»é‡ï¼š{{ book.viewCount }}</span>
      <span>æ”¶è—ï¼š{{ book.likeCount }}</span>
      <span>è¯„åˆ†ï¼š{{ book.rating }}</span>
    </div>
    <button @click="startReading">å¼€å§‹é˜…è¯»</button>
  </div>
</template>
```

### é˜…è¯»å™¨é›†æˆ

#### ç« èŠ‚åŠ è½½

```javascript
// api/reader.js
export function getChapterContent(chapterID) {
  return request.get(`/reader/chapters/${chapterID}/content`);
}

export function getBookChapters(bookID, page = 1, size = 20) {
  return request.get('/reader/chapters', {
    params: { bookId: bookID, page, size }
  });
}
```

```javascript
// pages/Reader.vue
<script setup>
import { ref, onMounted, watch } from 'vue';
import { useRoute } from 'vue-router';
import { getChapterContent } from '@/api/reader';

const route = useRoute();
const content = ref('');
const loading = ref(false);

const loadChapter = async (chapterId) => {
  loading.value = true;
  try {
    const result = await getChapterContent(chapterId);
    content.value = result.content;
  } catch (error) {
    console.error('åŠ è½½ç« èŠ‚å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

onMounted(() => {
  const chapterId = route.params.chapterId;
  loadChapter(chapterId);
});

watch(() => route.params.chapterId, (newId) => {
  if (newId) {
    loadChapter(newId);
  }
});
</script>
```

#### é˜…è¯»è¿›åº¦ä¿å­˜

```javascript
// api/reader.js
export function saveReadingProgress(bookId, chapterId, progress) {
  return request.post('/reader/progress', {
    bookId,
    chapterId,
    progress
  });
}

export function getReadingProgress(bookId) {
  return request.get(`/reader/progress/${bookId}`);
}
```

#### é˜…è¯»è®¾ç½®

```javascript
// api/reader.js
export function getReadingSettings() {
  return request.get('/reader/settings');
}

export function saveReadingSettings(settings) {
  return request.post('/reader/settings', settings);
}
```

```javascript
// components/ReaderSettings.vue
<script setup>
import { ref, onMounted } from 'vue';
import { getReadingSettings, saveReadingSettings } from '@/api/reader';

const settings = ref({
  fontSize: 16,
  fontFamily: 'å®‹ä½“',
  lineHeight: 1.5,
  backgroundColor: '#FFFFFF',
  textColor: '#000000',
  pageMode: 'scroll'
});

onMounted(async () => {
  try {
    const savedSettings = await getReadingSettings();
    if (savedSettings) {
      settings.value = savedSettings;
    }
  } catch (error) {
    console.error('è·å–é˜…è¯»è®¾ç½®å¤±è´¥:', error);
  }
});

const handleSave = async () => {
  try {
    await saveReadingSettings(settings.value);
    alert('ä¿å­˜æˆåŠŸï¼');
  } catch (error) {
    console.error('ä¿å­˜å¤±è´¥:', error);
  }
};
</script>
```

### æ¨èç³»ç»Ÿé›†æˆ

#### ä¸ªæ€§åŒ–æ¨è

```javascript
// api/recommendation.js
export function getPersonalizedRecommendations(limit = 10) {
  return request.get('/recommendation/personalized', {
    params: { limit }
  });
}

export function getSimilarItems(itemId, limit = 10) {
  return request.get('/recommendation/similar', {
    params: { itemId, limit }
  });
}

export function recordBehavior(behaviorData) {
  return request.post('/recommendation/behavior', behaviorData);
}
```

#### è¡Œä¸ºè¿½è¸ª

```javascript
// utils/tracking.js
import { recordBehavior } from '@/api/recommendation';

export function trackView(itemId) {
  recordBehavior({
    itemId,
    behaviorType: 'view',
    value: 1
  });
}

export function trackRead(itemId, chapterId, readTime) {
  recordBehavior({
    itemId,
    chapterID: chapterId,
    behaviorType: 'read',
    value: readTime
  });
}

export function trackLike(itemId) {
  recordBehavior({
    itemId,
    behaviorType: 'like',
    value: 1
  });
}
```

---

## æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

#### ç½‘ç»œé”™è¯¯å¤„ç†

```javascript
// utils/errorHandler.js
export function handleNetworkError(error) {
  if (!navigator.onLine) {
    return 'ç½‘ç»œè¿æ¥å·²æ–­å¼€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®';
  }
  
  if (error.code === 'ECONNABORTED') {
    return 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•';
  }
  
  return 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
}
```

#### ä¸šåŠ¡é”™è¯¯å¤„ç†

```javascript
export function handleBusinessError(code, message) {
  const errorMap = {
    40001: 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
    40002: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯',
    40003: 'ç”¨æˆ·å·²è¢«ç¦ç”¨',
    40301: 'æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº',
    40401: 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨',
    50001: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  };
  
  return errorMap[code] || message || 'æ“ä½œå¤±è´¥';
}
```

#### ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

```javascript
// utils/message.js
import { ElMessage } from 'element-plus';

export function showSuccessMessage(message) {
  ElMessage.success(message);
}

export function showErrorMessage(error) {
  let message;
  
  if (typeof error === 'string') {
    message = error;
  } else if (error.response) {
    message = error.response.data?.message || 'æ“ä½œå¤±è´¥';
  } else if (error.request) {
    message = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
  } else {
    message = error.message || 'æœªçŸ¥é”™è¯¯';
  }
  
  ElMessage.error(message);
}
```

### 2. æ€§èƒ½ä¼˜åŒ–

#### è¯·æ±‚ç¼“å­˜

```javascript
// utils/cache.js
const cache = new Map();
const CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é’Ÿ

export function getCachedData(key) {
  const cached = cache.get(key);
  
  if (!cached) return null;
  
  if (Date.now() - cached.timestamp > CACHE_DURATION) {
    cache.delete(key);
    return null;
  }
  
  return cached.data;
}

export function setCachedData(key, data) {
  cache.set(key, {
    data,
    timestamp: Date.now()
  });
}
```

```javascript
// api/bookstore.js
import { getCachedData, setCachedData } from '@/utils/cache';

export async function getBookDetail(bookId) {
  const cacheKey = `book_${bookId}`;
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = getCachedData(cacheKey);
  if (cached) {
    return cached;
  }
  
  // è¯·æ±‚æ–°æ•°æ®
  const data = await request.get(`/bookstore/books/${bookId}`);
  
  // å­˜å…¥ç¼“å­˜
  setCachedData(cacheKey, data);
  
  return data;
}
```

#### é˜²æŠ–èŠ‚æµ

```javascript
// utils/debounce.js
export function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

export function throttle(func, wait) {
  let timeout = null;
  let previous = 0;
  
  return function executedFunction(...args) {
    const now = Date.now();
    const remaining = wait - (now - previous);
    
    if (remaining <= 0 || remaining > wait) {
      if (timeout) {
        clearTimeout(timeout);
        timeout = null;
      }
      previous = now;
      func(...args);
    } else if (!timeout) {
      timeout = setTimeout(() => {
        previous = Date.now();
        timeout = null;
        func(...args);
      }, remaining);
    }
  };
}
```

```javascript
// ä½¿ç”¨é˜²æŠ–çš„æœç´¢
<script setup>
import { ref } from 'vue';
import { debounce } from '@/utils/debounce';
import { searchBooks } from '@/api/bookstore';

const searchKeyword = ref('');
const searchResults = ref([]);

const handleSearch = debounce(async (keyword) => {
  if (!keyword) {
    searchResults.value = [];
    return;
  }
  
  try {
    const results = await searchBooks(keyword);
    searchResults.value = results;
  } catch (error) {
    console.error('æœç´¢å¤±è´¥:', error);
  }
}, 500);
</script>
```

#### åˆ†é¡µåŠ è½½

```javascript
// composables/usePagination.js
import { ref, computed } from 'vue';

export function usePagination(fetchFunction) {
  const list = ref([]);
  const page = ref(1);
  const pageSize = ref(20);
  const total = ref(0);
  const loading = ref(false);
  
  const hasMore = computed(() => {
    return list.value.length < total.value;
  });
  
  const loadMore = async () => {
    if (loading.value || !hasMore.value) return;
    
    loading.value = true;
    try {
      const result = await fetchFunction(page.value, pageSize.value);
      list.value.push(...result.data);
      total.value = result.total;
      page.value++;
    } catch (error) {
      console.error('åŠ è½½å¤±è´¥:', error);
    } finally {
      loading.value = false;
    }
  };
  
  return {
    list,
    loading,
    hasMore,
    loadMore
  };
}
```

### 3. å®‰å…¨æ€§

#### Token å®‰å…¨å­˜å‚¨

```javascript
// utils/storage.js
// ä½¿ç”¨åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
import CryptoJS from 'crypto-js';

const SECRET_KEY = 'your-secret-key';

export function setSecureItem(key, value) {
  const encrypted = CryptoJS.AES.encrypt(value, SECRET_KEY).toString();
  localStorage.setItem(key, encrypted);
}

export function getSecureItem(key) {
  const encrypted = localStorage.getItem(key);
  if (!encrypted) return null;
  
  try {
    const decrypted = CryptoJS.AES.decrypt(encrypted, SECRET_KEY);
    return decrypted.toString(CryptoJS.enc.Utf8);
  } catch (error) {
    return null;
  }
}
```

#### XSS é˜²æŠ¤

```javascript
// utils/xss.js
export function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  
  return text.replace(/[&<>"']/g, m => map[m]);
}
```

#### CSRF é˜²æŠ¤

```javascript
// request.js ä¸­æ·»åŠ  CSRF Token
request.interceptors.request.use(config => {
  const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
  if (csrfToken) {
    config.headers['X-CSRF-Token'] = csrfToken;
  }
  return config;
});
```

---

## å¸¸è§é—®é¢˜

### Q1: Token è¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ

**A**: åœ¨å“åº”æ‹¦æˆªå™¨ä¸­è‡ªåŠ¨åˆ·æ–° Tokenï¼š

```javascript
// 401é”™è¯¯æ—¶è‡ªåŠ¨åˆ·æ–°Token
if (error.response.status === 401) {
  try {
    await refreshToken();
    return request(error.config); // é‡è¯•åŸè¯·æ±‚
  } catch (refreshError) {
    // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•é¡µ
    window.location.href = '/login';
  }
}
```

### Q2: å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼Ÿ

**A**: å¼€å‘ç¯å¢ƒä½¿ç”¨ä»£ç†ï¼š

```javascript
// vite.config.js
export default {
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
}
```

ç”Ÿäº§ç¯å¢ƒéœ€è¦åç«¯é…ç½®CORSã€‚

### Q3: å¦‚ä½•å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Ÿ

**A**: ä½¿ç”¨ FormDataï¼š

```javascript
export function uploadFile(file) {
  const formData = new FormData();
  formData.append('file', file);
  
  return request.post('/shared/storage/upload', formData, {
    headers: {
      'Content-Type': 'multipart/form-data'
    },
    onUploadProgress: (progressEvent) => {
      const progress = Math.round((progressEvent.loaded * 100) / progressEvent.total);
      console.log(`ä¸Šä¼ è¿›åº¦: ${progress}%`);
    }
  });
}
```

### Q4: å¦‚ä½•å®ç°è¯·æ±‚å–æ¶ˆï¼Ÿ

**A**: ä½¿ç”¨ AbortControllerï¼š

```javascript
const controller = new AbortController();

export function searchBooks(keyword) {
  return request.get('/bookstore/books/search', {
    params: { keyword },
    signal: controller.signal
  });
}

// å–æ¶ˆè¯·æ±‚
controller.abort();
```

### Q5: å¦‚ä½•å¤„ç†å¹¶å‘è¯·æ±‚ï¼Ÿ

**A**: ä½¿ç”¨ Promise.allï¼š

```javascript
async function loadPageData() {
  try {
    const [user, books, settings] = await Promise.all([
      getUserProfile(),
      getRecommendedBooks(),
      getReadingSettings()
    ]);
    
    return { user, books, settings };
  } catch (error) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
  }
}
```

---

## å®Œæ•´ç¤ºä¾‹é¡¹ç›®

### Vue 3 + Vite é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ api/                  # API æ¥å£
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ user.js
â”‚   â”œâ”€â”€ bookstore.js
â”‚   â”œâ”€â”€ reader.js
â”‚   â””â”€â”€ recommendation.js
â”œâ”€â”€ components/           # ç»„ä»¶
â”‚   â”œâ”€â”€ Header.vue
â”‚   â”œâ”€â”€ BookCard.vue
â”‚   â””â”€â”€ ReaderSettings.vue
â”œâ”€â”€ composables/          # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useAuth.js
â”‚   â”œâ”€â”€ usePagination.js
â”‚   â””â”€â”€ useReader.js
â”œâ”€â”€ pages/                # é¡µé¢
â”‚   â”œâ”€â”€ Home.vue
â”‚   â”œâ”€â”€ Login.vue
â”‚   â”œâ”€â”€ BookDetail.vue
â”‚   â””â”€â”€ Reader.vue
â”œâ”€â”€ stores/               # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ user.js
â”‚   â””â”€â”€ reader.js
â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ request.js
â”‚   â”œâ”€â”€ storage.js
â”‚   â””â”€â”€ debounce.js
â”œâ”€â”€ config/               # é…ç½®
â”‚   â””â”€â”€ api.js
â”œâ”€â”€ App.vue
â””â”€â”€ main.js
```

### ç¤ºä¾‹ä»“åº“

GitHub: [qingyu-frontend-example](https://github.com/qingyu/qingyu-frontend-example)

---

## ç›¸å…³æ–‡æ¡£

- [API å¿«é€Ÿå‚è€ƒ](./APIå¿«é€Ÿå‚è€ƒ.md)
- [ç”¨æˆ·ç³»ç»Ÿ API å‚è€ƒ](./ç”¨æˆ·ç³»ç»ŸAPIå‚è€ƒ.md)
- [ä¹¦åŸç³»ç»Ÿ API å‚è€ƒ](./ä¹¦åŸAPIå‚è€ƒ.md)
- [é˜…è¯»å™¨ API å‚è€ƒ](./é˜…è¯»å™¨APIå‚è€ƒ.md)

---

**ç»´æŠ¤è€…**: é’ç¾½åç«¯å›¢é˜Ÿ  
**è”ç³»æ–¹å¼**: backend@qingyu.com

