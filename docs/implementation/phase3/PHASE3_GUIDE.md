# Phase 3: AI功能与社区 - 实施指南 v1.0

> **文档状态**: 核心规划文档  
> **更新日期**: 2025-10-30  
> **负责人**: AI团队, 前端团队, 后端团队

---

## 1. 🎯 核心目标

**Phase 3 的核心目标是为青羽平台注入AI能力和社区活力，构建平台的核心差异化优势，提升用户粘性和创作体验。**

- **AI助手**: 为读者和作者提供智能问答与创作辅助。
- **AI工具**: 提供自动化内容生成工具，提升创作效率。
- **社区系统**: 建立用户之间的互动与交流渠道。
- **钱包与变现**: 完善平台的商业化闭环。

---

## 2. 📅 时间规划与状态

- **周期**: 4周 (2025-12-15 → 2026-01-12)
- **工时**: 180小时
- **状态**: 🟢 **未开始 (0%)**

| 领域 | 后端(h) | 前端(h) | 测试(h) | 文档(h) | 小计(h) |
|---|---|---|---|---|---|
| **工时分配** | 54 | 99 | 20 | 7 | **180** |

### 时间表
```
Week 1 (Dec 15-19):
  Mon-Tue: AI助手系统 (聊天、配额) (12h)
  Wed-Fri: AI工具系统 (大纲、角色生成) (16h)

Week 2 (Dec 22-26):
  Mon-Tue: 评论系统 (12h)
  Wed-Fri: 社区互动 (关注、消息) (14h)

Week 3 (Dec 29-Jan 2):
  Mon-Tue: 钱包与变现系统 (12h)
  Wed-Fri: 集成与优化 (15h)

Week 4 (Jan 5-9):
  Mon-Thu: 端到端测试与修复 (20h)
  Fri: 最终验收 (5h)
```

---

## 3. ✅ 功能模块与任务分解

### 3.1 AI助手系统 (进度: 0%)

#### 前端任务 (18h)
**模块**: `Qingyu_fronted/src/modules/ai/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **AI聊天界面** | 实现类似ChatGPT的聊天界面，支持会话管理。 | `AIChatView.vue` | 6h |
| 🔴 高 | **会话管理** | 创建、切换、删除不同的聊天会话。 | `SessionManager.vue` | 3h |
| 🔴 高 | **流式响应** | 实时显示AI生成的文本流，提升体验。 | `StreamingMessage.vue` | 4h |
| 🟡 中 | **配额显示** | 在界面上清晰展示用户的AI配额余量。 | `QuotaDisplay.vue` | 2h |
| 🟡 中 | **充值界面** | 提供购买更多AI配额的入口和流程。 | `QuotaRecharge.vue` | 3h |

#### 后端任务 (15h)
**模块**: `Qingyu_backend/service/ai/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **聊天API** | 实现支持流式响应 (SSE) 的聊天API。 | `chat_api.go`, `stream_handler.go` | 7h |
| **LLM集成** | 集成第三方大语言模型API (e.g., GPT, Claude)。 | `ai_service.go` | 5h |
| **配额管理** | 实现配额的消耗、查询和购买相关API。 | `quota_api.go` | 3h |

---

### 3.2 AI工具系统 (进度: 0%)

#### 前端任务 (24h)
**模块**: `Qingyu_fronted/src/modules/writer/tools/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **大纲生成器** | 用户输入创意或主题，AI生成多层级的小说大纲。| `OutlineGenerator.vue` | 6h |
| 🔴 高 | **角色生成器** | 根据用户描述，AI自动生成详细的角色卡。| `CharacterGenerator.vue` | 6h |
| 🟡 中 | **情节设计** | AI提供情节发展的建议、转折或创意。| `PlotDesigner.vue` | 5h |
| 🟡 中 | **一致性检查** | AI检查小说设定（如角色能力、时间线）的一致性。| `ConsistencyChecker.vue` | 4h |

#### 后端任务 (16h)
**模块**: `Qingyu_backend/service/ai/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **大纲生成** | 实现调用LLM生成结构化大纲的API。 | `writing_api.go` | 5h |
| **角色生成** | 实现调用LLM填充角色卡字段的API。 | `writing_api.go` | 5h |
| **RAG集成** | 集成RAG（检索增强生成），使AI工具能基于用户自己的设定进行生成，确保一致性。 | `rag_service.go` | 6h |

---

### 3.3 社区评论系统 (进度: 30%)

#### 前端任务 (20h)
**模块**: `Qingyu_fronted/src/modules/reader/components/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **评论列表** | 展示章节或书籍下的评论，支持排序。| `CommentList.vue` | 6h |
| 🔴 高 | **评论发布** | 实现输入框用于发布新评论和回复他人。| `CommentInput.vue` | 4h |
| 🔴 高 | **评论线程** | 以嵌套结构展示回复，形成完整的对话线程。| `CommentThread.vue` | 5h |
| 🟡 中 | **点赞系统** | 为评论添加点赞/取消点赞功能。| `LikeButton.vue` | 2h |

#### 后端任务 (10h)
**模块**: `Qingyu_backend/service/comment/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **评论CRUD** | 完善评论的增删改查API。 | `comment_api.go` | 4h |
| **评论线程** | 实现高效查询评论及其嵌套回复的逻辑。 | `comment_service.go` | 4h |
| **点赞系统** | 实现评论点赞的相关API。 | `like_api.go` | 2h |

---

### 3.4 社区互动与钱包 (进度: 0%)

#### 前端任务 (37h)
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🟡 中 | **用户关注** | 实现关注/取关作者的功能。| `FollowButton.vue` | 3h |
| 🟡 中 | **消息通知** | 实现站内信和通知中心。| `NotificationCenter.vue` | 5h |
| 🟡 中 | **书圈社区** | 创建基于书籍或主题的讨论区。| `CommunityView.vue` | 6h |
| 🟡 中 | **钱包页面** | 展示余额、交易记录，并提供充值/提现入口。| `WalletView.vue` | 5h |
| 🟡 中 | **充值/提现流程**| 实现完整的充值和提现流程页面。| `RechargeFlow.vue`, `WithdrawalFlow.vue` | 8h |

#### 后端任务 (23h)
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **关注功能** | 实现用户关注关系的API。 | `follow_api.go` | 2h |
| **消息系统** | 实现站内消息通知的API。 | `notification_api.go` | 4h |
| **社区功能** | 书圈的创建、加入、发帖等API。 | `community_api.go` | 4h |
| **充值支付** | 集成第三方支付接口，完成充值逻辑。| `payment_service.go` | 5h |
| **提现处理** | 实现用户提现申请的处理逻辑和API。| `withdrawal_service.go` | 4h |

---

## 4. 🔍 测试与验收计划

### 测试计划 (总计 50h)
| 类型 | 任务 | 关键点 | 工时 |
|---|---|---|:---:|
| **单元测试** | Service层测试 | `AIChatService` (含SSE), `CommentService`, `WalletService`, `QuotaService`。 | 20h |
| **集成测试** | 完整流程测试 | AI工具与编辑器的集成；评论与阅读器的集成；充值、消费、提现的完整财务流程。 | 15h |
| **性能测试** | AI响应与并发 | 测试AI聊天接口在高并发下的响应时间和稳定性；评论区高楼层加载性能。 | 10h |
| **用户体验**| 易用性测试 | 邀请内测用户体验AI工具和社区功能，收集反馈。 | 5h |

### 验收清单
#### 功能验收
- [ ] **AI助手**: 聊天功能可用，流式响应流畅，配额消耗准确。
- [ ] **AI工具**: 能根据输入生成质量合理的大纲、角色等内容，并能正确应用到项目中。
- [ ] **评论系统**: 评论和回复功能完整，点赞有效，线程展示正确。
- [ ] **社区功能**: 用户关注、消息通知功能正常。
- [ ] **钱包系统**: 充值、提现流程通畅，交易记录准确无误。

#### 性能验收
- [ ] AI聊天首次响应时间 < 3秒。
- [ ] 超过100条评论的评论区加载时间 < 1秒。
- [ ] 社区和钱包等数据密集型页面加载 < 2秒。

#### 质量验收
- [ ] 前后端单元测试覆盖率 > 85%。
- [ ] 集成测试通过率 > 95%。
- [ ] 无 P0 级 Bug。
- [ ] P1 级 Bug < 3个。
- [ ] AI生成内容的稳定性和安全性通过审查。

---

## 5. 📋 交付物

- ✅ 一个集成的AI助手系统（聊天+阅读辅助）。
- ✅ 一套实用的AI创作工具集（大纲、角色等）。
- ✅ 一个功能完整的社区评论与互动系统。
- ✅ 一个能完成商业闭环的钱包与变现系统。
- ✅ 经过完整测试和优化的前后端代码。
- ✅ 详细的AI服务集成文档和社区功能使用指南。
