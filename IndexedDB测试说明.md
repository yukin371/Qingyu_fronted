# IndexedDB 本地存储测试说明

## 🎯 测试目标

验证在无后端支持的情况下，使用 IndexedDB 本地存储的所有前端功能是否正常工作。

---

## 🚀 快速开始

### 1. 启动前端项目

```bash
cd Qingyu_fronted
npm run dev
```

浏览器打开：`http://localhost:5173`

### 2. 进入写作端

访问：`http://localhost:5173/writer/projects`

页面顶部会显示 **"📦 离线模式"** 标签（黄色）。

---

## ✅ 功能测试清单

### 测试1: 创建项目（2分钟）

**步骤：**
1. 点击右上角 **"新建项目"** 按钮
2. 输入信息：
   - 标题：`测试小说`
   - 描述：`这是一个测试项目`
   - 类型：`小说`
3. 点击 **"创建"**

**预期结果：**
- ✅ 弹出提示：**"项目创建成功（本地存储）"**
- ✅ 项目列表自动刷新，显示新项目
- ✅ 项目卡片显示正确信息（标题、描述、0字、0章节、草稿状态）

**验证：**
```javascript
// 打开浏览器控制台
// 查看 IndexedDB 数据
// Chrome: 开发者工具 → Application → IndexedDB → QingyuWriterDB → projects
```

---

### 测试2: 进入项目工作区（1分钟）

**步骤：**
1. 点击刚创建的项目卡片

**预期结果：**
- ✅ 跳转到项目工作区页面：`/writer/project/{projectId}`
- ✅ 左侧显示空文档列表（提示"暂无文档"）
- ✅ 右侧显示空编辑器

---

### 测试3: 创建文档（2分钟）

**步骤：**
1. 在左侧文档树区域，点击 **"新建章节"** 按钮
2. 输入标题：`第一章`
3. 点击确认

**预期结果：**
- ✅ 弹出提示：**"文档创建成功（本地存储）"**
- ✅ 左侧文档列表显示"第一章"
- ✅ 自动加载该文档到编辑器

**再次创建：**
- 重复步骤，创建"第二章"、"第三章"

---

### 测试4: 编辑内容（3分钟）

**步骤：**
1. 选中"第一章"
2. 在编辑器中输入内容：
   ```
   这是第一章的内容。
   
   今天天气很好，适合写作。
   ```
3. 观察右上角的保存状态

**预期结果：**
- ✅ 编辑时显示：**"未保存"**
- ✅ 字数统计实时更新（约30字）
- ✅ 保存状态显示：**"保存中..."** → **"已保存"**

---

### 测试5: 手动保存（1分钟）

**步骤：**
1. 修改内容，添加一段文字
2. 按 **Ctrl+S** (Windows) 或 **Cmd+S** (Mac)

**预期结果：**
- ✅ 弹出提示：**"保存成功（本地存储）"**
- ✅ 保存状态更新为"已保存"
- ✅ 显示最后保存时间

---

### 测试6: 自动保存（2分钟）

**步骤：**
1. 修改内容
2. **停止编辑，等待30秒**
3. 观察保存状态变化

**预期结果：**
- ✅ 30秒后自动保存
- ✅ 控制台输出：`📦 自动保存成功（本地存储）`
- ✅ 保存状态更新为"已保存"

---

### 测试7: 切换文档（2分钟）

**步骤：**
1. 在"第一章"中输入内容（不保存）
2. 点击左侧的"第二章"
3. 再点击回"第一章"

**预期结果：**
- ✅ 切换文档前自动保存当前内容
- ✅ "第二章"显示空内容
- ✅ 切换回"第一章"时，内容正确显示

---

### 测试8: 修改文档标题（1分钟）

**步骤：**
1. 在左侧文档列表中，鼠标悬停在"第一章"
2. 点击"重命名"图标
3. 修改标题为：`第一章：开端`
4. 保存

**预期结果：**
- ✅ 弹出提示：**"文档更新成功（本地存储）"**
- ✅ 左侧列表显示新标题
- ✅ 编辑器顶部显示新标题

---

### 测试9: 删除文档（1分钟）

**步骤：**
1. 在左侧文档列表中，点击"第三章"的删除图标
2. 确认删除

**预期结果：**
- ✅ 弹出确认对话框
- ✅ 确认后提示：**"文档删除成功（本地存储）"**
- ✅ 左侧列表移除"第三章"
- ✅ 如果当前正在编辑"第三章"，编辑器切换到其他文档或显示空白

---

### 测试10: 字数统计（2分钟）

**步骤：**
1. 回到项目列表：`/writer/projects`
2. 观察项目卡片的字数显示

**预期结果：**
- ✅ 项目字数 = 所有文档字数总和
- ✅ 章节数正确显示（2章）

---

### 测试11: 删除项目（1分钟）

**步骤：**
1. 在项目列表，点击项目卡片右上角的"更多"按钮（...）
2. 选择"删除"
3. 确认删除

**预期结果：**
- ✅ 弹出确认对话框
- ✅ 确认后提示：**"项目删除成功（本地存储）"**
- ✅ 项目列表移除该项目
- ✅ 该项目下的所有文档也被删除（级联删除）

---

### 测试12: 切换存储模式（1分钟）

**步骤：**
1. 在项目列表页面
2. 点击右上角的 **"切换在线"** 按钮

**预期结果：**
- ✅ 弹出提示：**"已切换到在线模式"**
- ✅ 页面顶部标签变为 **"🌐 在线模式"**（绿色）
- ✅ 项目列表清空（在线模式下没有数据）

**再次切换：**
- 点击 **"切换离线"** 按钮
- ✅ 切换回离线模式
- ✅ 之前创建的项目重新显示

---

### 测试13: 数据持久化（2分钟）

**步骤：**
1. 创建一个新项目，添加几个文档，编辑内容
2. 关闭浏览器标签页
3. 重新打开：`http://localhost:5173/writer/projects`

**预期结果：**
- ✅ 之前创建的项目依然存在
- ✅ 打开项目，文档列表正确显示
- ✅ 打开文档，内容完整保存

---

### 测试14: 多项目测试（3分钟）

**步骤：**
1. 创建3个不同的项目
2. 分别为每个项目创建2-3个文档
3. 每个文档输入不同内容
4. 返回项目列表

**预期结果：**
- ✅ 3个项目都显示在列表中
- ✅ 每个项目的字数和章节数正确
- ✅ 进入每个项目，文档树正确显示
- ✅ 打开每个文档，内容正确无误

---

## 🔍 IndexedDB 数据检查

### 在浏览器开发者工具中查看数据

**Chrome / Edge:**
1. 按 F12 打开开发者工具
2. 切换到 **Application** 标签
3. 左侧展开 **Storage** → **IndexedDB** → **QingyuWriterDB**
4. 查看三张表：
   - **projects** - 项目表
   - **documents** - 文档表
   - **settings** - 设置表

**Firefox:**
1. 按 F12 打开开发者工具
2. 切换到 **Storage** 标签
3. 展开 **Indexed DB** → **QingyuWriterDB**

---

## 📊 性能测试

### 测试15: 大量数据（5分钟）

**步骤：**
1. 创建1个项目
2. 创建50个文档（可以写脚本批量创建）
3. 每个文档输入1000字内容
4. 观察性能表现

**预期结果：**
- ✅ 文档列表渲染流畅
- ✅ 切换文档响应快速（<200ms）
- ✅ 保存操作不阻塞界面
- ✅ 浏览器不卡顿

---

## ⚠️ 已知限制

### 离线模式不支持的功能

1. **文档移动（层级调整）**
   - 离线模式不支持拖拽调整文档层级
   - 切换到在线模式后可用

2. **AI 辅助写作**
   - 需要后端 AI 服务支持
   - 离线模式下 AI 功能不可用

3. **版本历史**
   - 离线模式仅保存最新版本
   - 不支持历史版本查看和恢复

4. **多设备同步**
   - IndexedDB 数据存储在本地浏览器
   - 不支持跨设备同步

---

## 🐛 常见问题

### Q1: 数据丢失怎么办？

**A:** IndexedDB 数据存储在浏览器中：
- ❌ 不要清除浏览器数据
- ❌ 不要使用隐私模式（数据会在关闭时删除）
- ✅ 建议定期导出数据备份

### Q2: 如何导出数据？

**A:** 在浏览器控制台执行：
```javascript
import { getAllItems, STORES } from '@/utils/indexedDB'

// 导出所有数据
const projects = await getAllItems(STORES.PROJECTS)
const documents = await getAllItems(STORES.DOCUMENTS)

const exportData = {
  projects,
  documents,
  exportTime: new Date().toISOString()
}

// 复制到剪贴板或下载为文件
console.log(JSON.stringify(exportData, null, 2))
```

### Q3: 如何清空所有数据？

**A:** 在浏览器控制台执行：
```javascript
import { deleteDB } from '@/utils/indexedDB'
await deleteDB()
```

或者在开发者工具中手动删除 IndexedDB。

### Q4: 能存储多少数据？

**A:** IndexedDB 存储限制：
- **Chrome/Edge:** 约 50% 可用磁盘空间
- **Firefox:** 约 2GB（可申请更多）
- **Safari:** 约 1GB

对于普通写作场景，完全够用（100万字约2MB）。

---

## ✅ 测试报告模板

完成测试后，请填写以下报告：

```markdown
# IndexedDB 本地存储测试报告

**测试日期：** 2025-10-29
**测试人员：** [您的名字]
**浏览器：** Chrome 120 / Firefox 121 / Safari 17
**操作系统：** Windows 11 / macOS 14 / Linux

## 测试结果

| 测试项 | 状态 | 备注 |
|-------|------|------|
| 测试1: 创建项目 | ✅ / ❌ | |
| 测试2: 进入项目工作区 | ✅ / ❌ | |
| 测试3: 创建文档 | ✅ / ❌ | |
| 测试4: 编辑内容 | ✅ / ❌ | |
| 测试5: 手动保存 | ✅ / ❌ | |
| 测试6: 自动保存 | ✅ / ❌ | |
| 测试7: 切换文档 | ✅ / ❌ | |
| 测试8: 修改文档标题 | ✅ / ❌ | |
| 测试9: 删除文档 | ✅ / ❌ | |
| 测试10: 字数统计 | ✅ / ❌ | |
| 测试11: 删除项目 | ✅ / ❌ | |
| 测试12: 切换存储模式 | ✅ / ❌ | |
| 测试13: 数据持久化 | ✅ / ❌ | |
| 测试14: 多项目测试 | ✅ / ❌ | |
| 测试15: 大量数据 | ✅ / ❌ | |

## 发现的问题

1. [问题描述]
   - 重现步骤：
   - 预期结果：
   - 实际结果：

## 整体评价

- [ ] 完全满足需求，可以正常使用
- [ ] 基本满足需求，有少量问题
- [ ] 存在严重问题，需要修复

## 其他建议

[您的建议]
```

---

## 🎉 测试通过标准

**基本功能（必须全部通过）：**
- ✅ 创建、编辑、删除项目
- ✅ 创建、编辑、删除文档
- ✅ 手动保存和自动保存
- ✅ 字数统计正确
- ✅ 数据持久化

**性能要求：**
- ✅ 界面响应流畅（<300ms）
- ✅ 支持至少50个文档
- ✅ 支持至少10万字内容

**稳定性要求：**
- ✅ 无数据丢失
- ✅ 无浏览器崩溃
- ✅ 无控制台错误

---

**祝测试顺利！🚀**

如有任何问题，请及时反馈。




