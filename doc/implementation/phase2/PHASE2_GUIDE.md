# Phase 2: 写作端完整功能 - 实施指南 v1.0

> **文档状态**: 核心规划文档  
> **更新日期**: 2025-10-30  
> **负责人**: 前端团队, 后端团队

---

## 1. 🎯 核心目标

**Phase 2 的核心目标是完成青羽平台写作端的所有核心功能，为作者提供一个强大、智能、高效的创作环境。**

- **项目管理**: 提供清晰、便捷的作品管理功能。
- **编辑器**: 打造支持Markdown和富文本、具备自动保存和版本历史的核心编辑器。
- **设定管理**: 构建创新的角色卡、世界观、时间线等设定管理工具。
- **数据统计**: 为作者提供多维度的数据分析与反馈。

---

## 2. 📅 时间规划与状态

- **周期**: 3周 (2025-11-24 → 2025-12-15)
- **工时**: 150小时
- **状态**: 🟢 **未开始 (0%)**

| 领域 | 后端(h) | 前端(h) | 测试(h) | 文档(h) | 小计(h) |
|---|---|---|---|---|---|
| **工时分配** | 32 | 87 | 20 | 11 | **150** |

### 时间表
```
Week 1 (Nov 24-28):
  Mon-Tue: 项目管理系统 (12h)
  Wed-Fri: 编辑器基础功能 (18h)

Week 2 (Dec 1-5):
  Mon-Tue: 编辑器高级功能 (版本历史、大纲) (12h)
  Wed-Fri: 设定管理 (角色卡、世界观) (15h)

Week 3 (Dec 8-12):
  Mon-Tue: 设定管理完成 (时间线、关系图谱) (12h)
  Wed-Fri: 数据统计与可视化 (12h)
  周末: 集成测试与优化
```

---

## 3. ✅ 功能模块与任务分解

### 3.1 项目管理系统 (进度: 30%)

#### 前端任务 (19h)
**模块**: `Qingyu_fronted/src/modules/writer/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **项目列表** | 网格/列表视图展示用户的所有项目，支持搜索筛选。| `ProjectsView.vue` | 5h |
| 🔴 高 | **项目卡片** | 展示项目封面、标题、字数、更新状态等核心信息。| `ProjectCard.vue` | 3h |
| 🔴 高 | **项目创建/编辑**| 通过对话框完成项目的创建和核心信息编辑。| `ProjectDialog.vue` | 4h |
| 🟡 中 | **项目统计** | 在项目卡片或列表项中展示关键统计数据。| `ProjectStats.vue` | 3h |
| 🟡 中 | **快速操作** | 实现删除、归档等快速操作功能。| `ConfirmDialog.vue` | 2h |

#### 后端任务 (9h)
**模块**: `Qingyu_backend/service/project/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **项目CRUD** | 实现项目的增删改查核心API。 | `project_service.go` | 4h |
| **权限检查** | 确保用户只能操作自己的项目。 | `project_service.go` | 2h |
| **统计信息** | 提供获取项目字数、章节数等统计信息的API。 | `stats_service.go` | 3h |

---

### 3.2 编辑器核心功能 (进度: 20%)

#### 前端任务 (27h)
**模块**: `Qingyu_fronted/src/modules/writer/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **编辑器主体** | 集成Markdown/富文本编辑器，支持双模式切换。| `EditorView.vue` | 8h |
| 🔴 高 | **工具栏** | 提供字体格式、标题、列表、插入图片等常用功能。| `EditorToolbar.vue` | 4h |
| 🔴 高 | **大纲管理** | 左侧面板展示文档树形大纲，支持拖拽和跳转。| `OutlinePanel.vue` | 5h |
| 🔴 高 | **自动保存** | 实现基于内容变化的防抖自动保存逻辑 (30s)。| `useAutoSave.ts` | 3h |
| 🟡 中 | **版本历史** | 查看、对比和恢复文档的历史版本。| `VersionHistory.vue` | 4h |
| 🟡 中 | **代码高亮** | 为编辑器中的代码块提供语法高亮。| `CodeHighlight.vue` | 3h |

#### 后端任务 (9h)
**模块**: `Qingyu_backend/service/document/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **文档保存** | 实现文档内容的保存与更新API。 | `document_api.go` | 3h |
| **版本管理** | 实现文档版本的创建、查询、恢复API。 | `version_api.go` | 3h |
| **并发控制** | 防止多人同时编辑同一文档时的数据覆盖问题。 | `document_service.go` | 3h |

---

### 3.3 设定管理系统 (进度: 0%)

#### 前端任务 (27h)
**模块**: `Qingyu_fronted/src/modules/writer/settings/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **角色卡管理** | 实现角色卡的创建、编辑、查看功能，支持丰富字段。| `CharacterManager.vue` | 8h |
| 🔴 高 | **世界观编辑** | 创建和编辑世界观设定（地点、时代、规则等）。| `WorldSettingsView.vue`| 6h |
| 🔴 高 | **时间线编辑** | 以时间轴形式管理故事中的关键事件。| `TimelineEditor.vue` | 5h |
| 🟡 中 | **关系图谱** | 可视化展示角色之间的关系网络。| `RelationshipGraph.vue`| 5h |
| 🟡 中 | **标签系统** | 为设定添加标签，便于分类和检索。| `TagManager.vue` | 3h |

#### 后端任务 (10h)
**模块**: `Qingyu_backend/service/setting/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **角色CRUD** | 实现角色卡的增删改查API。 | `character_api.go` | 4h |
| **设定项管理**| 实现地点、世界观等通用设定项的CRUD API。| `location_api.go` | 3h |
| **关系处理** | 实现角色关系的创建和查询API。| `relationship_service.go` | 3h |

---

### 3.4 数据统计与分析 (进度: 0%)

#### 前端任务 (14h)
**模块**: `Qingyu_fronted/src/modules/writer/stats/`
| 优先级 | 任务 | 目标 | 涉及文件 | 工时 |
|:---:|---|---|---|:---:|
| 🔴 高 | **统计仪表板** | 集中展示字数、更新、社交等多维度统计数据。 | `StatisticsView.vue` | 6h |
| 🟡 中 | **图表展示** | 使用ECharts等库将数据可视化为趋势图。 | `ChartComponents.vue`| 5h |
| 🟡 中 | **数据导出** | 提供将统计数据导出为CSV或图片的功能。 | `DataExport.vue` | 3h |

#### 后端任务 (5h)
**模块**: `Qingyu_backend/service/stats/`
| 任务 | 目标 | 涉及文件 | 工时 |
|---|---|---|:---:|
| **统计计算** | 提供计算每日字数、更新频率等统计数据的API。 | `stats_api.go` | 3h |
| **数据缓存** | 缓存统计结果，避免重复计算，提高响应速度。 | `stats_service.go` | 2h |

---

## 4. 🔍 测试与验收计划

### 测试计划 (总计 41h)
| 类型 | 任务 | 关键点 | 工时 |
|---|---|---|:---:|
| **单元测试** | Service层测试 | 重点测试 `ProjectService`, `DocumentService` (含版本控制), `CharacterService` 和 `StatsService` 的逻辑正确性。 | 20h |
| **集成测试** | 完整流程测试 | 覆盖“创建项目→创建文档→编辑内容→自动保存→查看版本→创建角色卡→查看统计”的完整作者流程。| 10h |
| **性能测试** | 编辑器性能 | 测试大文档的加载与编辑性能，自动保存的流畅度，大纲渲染性能。 | 11h |

### 验收清单
#### 功能验收
- [ ] **项目管理**: 能够完整地创建、编辑、删除和搜索项目。
- [ ] **编辑器**: Markdown/富文本模式正常，自动保存按预期工作，版本历史可查看和恢复。
- [ ] **大纲管理**: 文档树形大纲能正确显示，拖拽排序和跳转功能正常。
- [ ] **设定管理**: 角色卡、世界观等设定项能够完整创建和编辑。
- [ ] **数据统计**: 统计数据准确，图表能正确渲染。

#### 性能验收
- [ ] 编辑器页面加载时间 < 2秒。
- [ ] 自动保存过程无感知，不影响用户输入。
- [ ] 超过100个章节的大纲渲染流畅，无卡顿。
- [ ] 统计数据计算和加载时间 < 1秒。

#### 质量验收
- [ ] 前后端单元测试覆盖率 > 80%。
- [ ] 无 P0 级 Bug。
- [ ] P1 级 Bug < 5个。
- [ ] 编辑器在主流浏览器 (Chrome, Firefox, Edge) 下表现一致。

---

## 5. 📋 交付物

- ✅ 一个功能完整的项目管理系统。
- ✅ 一个稳定、高效、功能丰富的在线编辑器。
- ✅ 一套创新的、结构化的设定管理工具。
- ✅ 一个直观的数据统计与分析仪表板。
- ✅ 后端支持以上功能的所有API，并经过性能测试。
- ✅ 单元测试和集成测试报告。
- ✅ 详细的API文档和前端技术文档。
