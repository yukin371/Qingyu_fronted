# 管理后台使用指南

> **版本**: v1.0  
> **最后更新**: 2025-10-21  
> **开发状态**: ✅ 已完成

---

## 📋 概述

青羽管理后台是一个功能完善的后台管理系统，提供用户管理、内容审核、提现审核、操作日志等功能。

### 技术栈

- **前端框架**: Vue 3 + TypeScript
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **图表库**: ECharts
- **路由**: Vue Router
- **HTTP客户端**: Axios

---

## 🚀 快速开始

### 访问地址

```
http://localhost:5173/admin/dashboard
```

### 权限要求

- 必须登录
- 必须具有管理员角色（`admin` 或 `super_admin`）

### 路由结构

```
/admin
├── /dashboard      - 仪表板
├── /reviews        - 内容审核
├── /withdrawals    - 提现审核
├── /users          - 用户管理
└── /logs           - 操作日志
```

---

## 📦 核心功能

### 1. 仪表板 (Dashboard)

**路径**: `/admin/dashboard`

#### 功能特性

- **统计卡片**: 显示用户总数、待审核数、今日收入、活跃用户
- **数据图表**: 
  - 用户增长趋势（支持周/月/年切换）
  - 交易金额趋势（支持周/月切换）
  - 内容发布统计（饼图）
- **最近活动**: 显示最近的系统活动
- **快捷操作**: 快速跳转到各个管理页面

#### 使用方法

```typescript
// 点击统计卡片可跳转到对应页面
- 点击"用户总数" → 跳转到用户管理
- 点击"待审核" → 跳转到内容审核
- 点击"今日收入" → 查看详细数据
```

---

### 2. 内容审核 (Review Management)

**路径**: `/admin/reviews`

#### 功能特性

- 待审核内容列表
- 按内容类型筛选（书籍/章节/文档/评论）
- 搜索功能
- 批量审核（计划中）
- 审核详情查看
- 批准/拒绝操作

#### 使用流程

1. 选择内容类型进行筛选
2. 点击"详情"查看完整内容
3. 点击"批准"通过审核
4. 点击"拒绝"并填写拒绝原因

#### 审核卡片组件

```vue
<ReviewCard
  :item="reviewItem"
  @approve="handleApprove"
  @reject="handleReject"
  @view="handleView"
/>
```

---

### 3. 提现审核 (Withdrawal Management)

**路径**: `/admin/withdrawals`

#### 功能特性

- 提现申请列表
- 按状态筛选（待审核/已批准/已拒绝）
- 日期范围筛选
- 提现详情查看
- 批准/拒绝操作

#### 使用流程

1. 查看提现申请列表
2. 点击"批准"同意提现
3. 点击"拒绝"并填写拒绝原因
4. 系统自动更新状态

#### 统计信息

- 待审核数量
- 今日已审核数量

---

### 4. 用户管理 (User Management)

**路径**: `/admin/users`

#### 功能特性

- 用户列表（分页）
- 搜索和筛选
- 用户详情查看
- 用户统计信息
- 角色和权限管理
- 用户状态管理（启用/禁用）

---

### 5. 操作日志 (Operation Logs)

**路径**: `/admin/logs`

#### 功能特性

- 操作日志列表
- 按操作类型筛选
- 按管理员筛选
- 日期范围筛选
- 日志详情查看
- 导出功能（计划中）

#### 日志类型

- `approve_content` - 批准内容
- `reject_content` - 拒绝内容
- `approve_withdraw` - 批准提现
- `reject_withdraw` - 拒绝提现
- `update_user` - 更新用户
- `delete_user` - 删除用户

---

## 🎨 组件库

### 管理员公共组件

#### 1. StatCard (统计卡片)

```vue
<StatCard
  title="用户总数"
  :value="12586"
  icon="el-icon-user"
  iconBg="#409eff"
  :trend="12.5"
  format="number"
  @click="handleClick"
/>
```

**属性说明**:
- `title`: 卡片标题
- `value`: 数值
- `icon`: 图标类名
- `iconBg`: 图标背景色
- `trend`: 增长率（可选）
- `format`: 格式化类型（number/currency/percent）
- `onClick`: 点击回调

#### 2. ChartCard (图表卡片)

```vue
<ChartCard
  title="用户增长趋势"
  :option="chartOption"
  height="350px"
>
  <template #extra>
    <el-button>操作</el-button>
  </template>
</ChartCard>
```

#### 3. ReviewCard (审核卡片)

```vue
<ReviewCard
  :item="reviewItem"
  @approve="handleApprove"
  @reject="handleReject"
  @view="handleView"
/>
```

### 钱包组件

#### 1. WalletCard (钱包卡片)

```vue
<WalletCard
  :balance="1250.50"
  :availableAmount="1200.50"
  :frozenAmount="50.00"
  :showExtra="true"
  @refresh="handleRefresh"
  @recharge="handleRecharge"
  @withdraw="handleWithdraw"
/>
```

#### 2. TransactionList (交易记录列表)

```vue
<TransactionList
  :transactions="transactions"
  :loading="loading"
  :total="total"
  :page="page"
  :pageSize="pageSize"
  @typeChange="handleTypeChange"
  @pageChange="handlePageChange"
/>
```

#### 3. RechargeDialog (充值对话框)

```vue
<RechargeDialog
  v-model="dialogVisible"
  :loading="loading"
  @confirm="handleConfirm"
/>
```

#### 4. WithdrawDialog (提现对话框)

```vue
<WithdrawDialog
  v-model="dialogVisible"
  :availableAmount="availableAmount"
  :loading="loading"
  @confirm="handleConfirm"
/>
```

### 文件管理组件

#### FileUploader (文件上传器)

```vue
<FileUploader
  accept="image/*"
  :multiple="true"
  :limit="10"
  :maxSize="10"
  :drag="true"
  @success="handleSuccess"
  @error="handleError"
/>
```

---

## 🔧 API 集成

### 共享服务API

所有API调用已封装在 `src/api/shared/` 目录下：

```typescript
import * as walletAPI from '@/api/shared/wallet'
import * as storageAPI from '@/api/shared/storage'
import * as adminAPI from '@/api/shared/admin'
import * as authAPI from '@/api/shared/auth'
```

### 使用示例

```typescript
// 获取钱包余额
const balance = await walletAPI.getBalance()

// 审核内容
await adminAPI.reviewContent({
  content_id: 'doc_123',
  content_type: 'document',
  action: 'approve'
})

// 审核提现
await adminAPI.reviewWithdraw({
  withdraw_id: 'wd_001',
  approved: true
})
```

---

## 💾 状态管理

### Store 模块

#### 1. 钱包Store (`useWalletStore`)

```typescript
import { useWalletStore } from '@/stores/wallet'

const walletStore = useWalletStore()

// 获取余额
await walletStore.fetchBalance()

// 充值
await walletStore.recharge({ amount: 100, method: 'alipay' })

// 获取交易记录
await walletStore.fetchTransactions({ page: 1, page_size: 20 })
```

#### 2. 存储Store (`useStorageStore`)

```typescript
import { useStorageStore } from '@/stores/storage'

const storageStore = useStorageStore()

// 上传文件
await storageStore.uploadFile(file, 'uploads/')

// 获取文件列表
await storageStore.fetchFiles({ page: 1, page_size: 20 })

// 删除文件
await storageStore.deleteFile(fileId)
```

---

## 🎯 工具函数

### 管理员工具 (`src/utils/admin.ts`)

```typescript
import {
  formatCurrency,
  formatPercent,
  formatLargeNumber,
  calculateGrowthRate,
  exportToCSV,
  exportToJSON
} from '@/utils/admin'

// 格式化金额
const formatted = formatCurrency(1250.50) // "¥1,250.50"

// 格式化百分比
const percent = formatPercent(12.5) // "12.5%"

// 计算增长率
const growth = calculateGrowthRate(120, 100) // 20

// 导出CSV
exportToCSV(data, 'filename', ['列1', '列2'])
```

### 图表配置 (`src/utils/chartConfig.ts`)

```typescript
import {
  createLineChartOption,
  createBarChartOption,
  createPieChartOption
} from '@/utils/chartConfig'

// 创建折线图配置
const lineOption = createLineChartOption(
  ['周一', '周二', '周三'],
  [
    { name: '新增用户', data: [120, 132, 101] },
    { name: '活跃用户', data: [220, 182, 191] }
  ]
)
```

---

## 🎨 样式定制

### 使用管理员样式

```vue
<style scoped lang="scss">
@import '@/styles/admin.scss';

.my-component {
  @extend .admin-card;
}
</style>
```

### 颜色方案

```scss
$admin-primary: #409eff;
$admin-success: #67c23a;
$admin-warning: #e6a23c;
$admin-danger: #f56c6c;
$admin-info: #909399;
```

---

## 🔐 权限控制

### 路由守卫

系统会自动检查用户是否有管理员权限：

```typescript
// 在 src/router/index.js 中
{
  path: '/admin',
  meta: { requiresAuth: true, requiresAdmin: true }
}
```

### 权限检查

```typescript
import { useAuthStore } from '@/stores/auth'

const authStore = useAuthStore()

// 检查是否为管理员
if (authStore.isAdmin) {
  // 执行管理员操作
}

// 检查特定权限
if (authStore.hasPermission('admin:users')) {
  // 执行用户管理操作
}
```

---

## 📱 响应式设计

管理后台支持多种设备：

- **桌面端**: 最佳体验（>1200px）
- **平板端**: 良好支持（768px-1200px）
- **移动端**: 基础支持（<768px）

---

## 🐛 调试技巧

### 开发模式

```bash
npm run dev
```

### 查看网络请求

打开浏览器开发者工具 → Network 标签

### 查看Store状态

安装 Vue DevTools 扩展，可以查看 Pinia store 的状态

---

## 📝 待办事项

- [ ] 批量审核功能
- [ ] 日志导出功能
- [ ] 数据统计报表
- [ ] 实时通知功能
- [ ] 更多图表类型
- [ ] 深色模式支持

---

## 🤝 贡献指南

1. 遵循 Vue 3 Composition API 规范
2. 使用 TypeScript 编写类型安全的代码
3. 组件应该可复用和可测试
4. 遵循 ESLint 和 Prettier 规范
5. 提交代码前运行 `npm run lint`

---

## 📚 相关文档

- [共享服务API文档](../api/frontend/shared/共享服务API参考.md)
- [前端集成指南](../api/frontend/前端集成指南.md)
- [组件架构设计](../architecture/组件架构设计.md)

---

**最后更新**: 2025-10-21  
**维护者**: 青羽前端团队  
**版本**: v1.0

