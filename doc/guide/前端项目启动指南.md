# 青羽前端项目启动指南

**创建日期**: 2025-10-27  
**项目状态**: 准备启动  
**预计完成时间**: 1小时

---

## 📋 前置条件检查

在开始之前，请确保已安装：

- ✅ Node.js 16+ (`node --version`)
- ✅ npm 或 pnpm (`npm --version` 或 `pnpm --version`)
- ✅ Git (`git --version`)

---

## 🚀 第一步：项目初始化（5分钟）

### 1.1 检查当前项目状态

```bash
cd Qingyu_fronted
ls -la
```

**说明**: 检查项目是否已有package.json等文件

---

### 1.2 安装核心依赖（如果还没有）

```bash
# 使用npm
npm install vue-router@4 pinia axios
npm install element-plus @element-plus/icons-vue
npm install tailwindcss postcss autoprefixer
npm install -D typescript @types/node

# 或使用pnpm（推荐，更快）
pnpm add vue-router@4 pinia axios
pnpm add element-plus @element-plus/icons-vue
pnpm add tailwindcss postcss autoprefixer
pnpm add -D typescript @types/node
```

---

## 🔧 第二步：创建配置文件（10分钟）

### 2.1 创建 `vite.config.ts`

在项目根目录创建或更新此文件：

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
  
  // 路径别名
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
  
  // 开发服务器配置
  server: {
    port: 5173,
    open: true, // 自动打开浏览器
    
    // 代理配置（解决跨域问题）
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        // rewrite: (path) => path.replace(/^\/api/, ''), // 如果需要重写路径
      },
    },
  },
  
  // 构建配置
  build: {
    outDir: 'dist',
    sourcemap: false,
    rollupOptions: {
      output: {
        // 分包策略
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus'],
        },
      },
    },
  },
})
```

---

### 2.2 创建 `tailwind.config.js`

```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#f0f9ff',
          100: '#e0f2fe',
          500: '#0ea5e9',
          600: '#0284c7',
          700: '#0369a1',
        },
      },
    },
  },
  plugins: [],
}
```

---

### 2.3 创建 `postcss.config.js`

```javascript
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

---

### 2.4 更新 `tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    },

    /* Type definitions */
    "types": ["vite/client", "element-plus/global"]
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

---

### 2.5 创建 `tsconfig.node.json`

```json
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}
```

---

### 2.6 创建环境变量文件

**`.env.development`**:
```bash
# 开发环境
VITE_API_BASE_URL=http://localhost:8080/api/v1
VITE_APP_TITLE=青羽写作平台（开发）
VITE_APP_ENV=development
```

**`.env.production`**:
```bash
# 生产环境
VITE_API_BASE_URL=https://api.qingyu.com/api/v1
VITE_APP_TITLE=青羽写作平台
VITE_APP_ENV=production
```

**注意**: 将`.env.development`和`.env.production`添加到`.gitignore`（如果包含敏感信息）

---

## 📁 第三步：创建项目结构（5分钟）

在`src/`目录下创建以下结构：

```bash
cd src

# 创建目录
mkdir -p api
mkdir -p assets/{images,styles}
mkdir -p components/{common,layout}
mkdir -p composables
mkdir -p layouts
mkdir -p pages/{Login,Bookstore,Reader,Writer,Profile,Wallet}
mkdir -p router
mkdir -p stores
mkdir -p types
mkdir -p utils
```

**最终结构**:
```
src/
├── api/                    # API接口封装
├── assets/                 # 静态资源
│   ├── images/
│   └── styles/
├── components/             # 公共组件
│   ├── common/
│   └── layout/
├── composables/            # 组合式函数
├── layouts/                # 页面布局
├── pages/                  # 页面
│   ├── Login/
│   ├── Bookstore/
│   ├── Reader/
│   ├── Writer/
│   ├── Profile/
│   └── Wallet/
├── router/                 # 路由配置
├── stores/                 # 状态管理
├── types/                  # TypeScript类型
├── utils/                  # 工具函数
├── App.vue
├── main.ts
└── style.css
```

---

## 🔌 第四步：创建核心工具文件（15分钟）

### 4.1 创建 `src/utils/request.ts`

```typescript
import axios from 'axios'
import type { AxiosInstance, AxiosRequestConfig, AxiosResponse, InternalAxiosRequestConfig } from 'axios'
import { ElMessage } from 'element-plus'

// 创建axios实例
const request: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
})

// 请求拦截器
request.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    // 添加Token
    const token = localStorage.getItem('token')
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  (error) => {
    console.error('请求错误:', error)
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  (response: AxiosResponse) => {
    const { code, message, data } = response.data

    // 根据后端统一响应格式处理
    if (code === 200 || code === 201) {
      return data
    } else {
      ElMessage.error(message || '请求失败')
      return Promise.reject(new Error(message))
    }
  },
  (error) => {
    if (!error.response) {
      ElMessage.error('网络错误，请检查网络连接')
      return Promise.reject(error)
    }

    const { status } = error.response

    switch (status) {
      case 401:
        // Token过期，跳转登录
        ElMessage.error('登录已过期，请重新登录')
        localStorage.removeItem('token')
        localStorage.removeItem('userId')
        localStorage.removeItem('username')
        // 跳转到登录页
        window.location.href = '/login'
        break
      case 403:
        ElMessage.error('没有权限访问')
        break
      case 404:
        ElMessage.error('请求的资源不存在')
        break
      case 500:
        ElMessage.error('服务器错误')
        break
      default:
        ElMessage.error(error.response.data?.message || '请求失败')
    }

    return Promise.reject(error)
  }
)

export default request
```

---

### 4.2 创建 `src/types/api.d.ts`

```typescript
/**
 * 通用API类型定义
 */

// API响应基础结构
export interface APIResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp?: string
}

// 分页请求参数
export interface PaginationParams {
  page: number
  pageSize: number
  sortBy?: string
  sortOrder?: 'asc' | 'desc'
}

// 分页响应结构
export interface PaginationResponse<T> {
  items: T[]
  total: number
  page: number
  pageSize: number
  totalPages: number
}

// 通用ID参数
export interface IDParam {
  id: string
}

// 通用查询参数
export interface QueryParams {
  keyword?: string
  category?: string
  status?: string
  [key: string]: any
}
```

---

### 4.3 创建 `src/types/user.d.ts`

```typescript
/**
 * 用户相关类型定义
 */

// 用户信息
export interface UserInfo {
  id: string
  username: string
  email: string
  nickname?: string
  avatar?: string
  bio?: string
  phone?: string
  role: string
  status: string
  createdAt: string
  updatedAt: string
}

// 登录请求
export interface LoginRequest {
  username: string
  password: string
}

// 登录响应
export interface LoginResponse {
  token: string
  userID: string
  username: string
  role?: string
}

// 注册请求
export interface RegisterRequest {
  username: string
  email: string
  password: string
  confirmPassword?: string
}

// 更新个人信息请求
export interface UpdateProfileRequest {
  nickname?: string
  avatar?: string
  bio?: string
  phone?: string
}
```

---

### 4.4 创建 `src/stores/user.ts`

```typescript
import { defineStore } from 'pinia'
import { ref } from 'vue'
import type { UserInfo } from '@/types/user'

export const useUserStore = defineStore('user', () => {
  // 状态
  const token = ref(localStorage.getItem('token') || '')
  const userId = ref(localStorage.getItem('userId') || '')
  const username = ref(localStorage.getItem('username') || '')
  const userInfo = ref<UserInfo | null>(null)

  // 计算属性
  const isLogin = computed(() => !!token.value)

  // 方法
  const setToken = (newToken: string) => {
    token.value = newToken
    localStorage.setItem('token', newToken)
  }

  const setUserInfo = (info: UserInfo) => {
    userInfo.value = info
    userId.value = info.id
    username.value = info.username
    localStorage.setItem('userId', info.id)
    localStorage.setItem('username', info.username)
  }

  const clearUserInfo = () => {
    token.value = ''
    userId.value = ''
    username.value = ''
    userInfo.value = null
    localStorage.removeItem('token')
    localStorage.removeItem('userId')
    localStorage.removeItem('username')
  }

  return {
    // 状态
    token,
    userId,
    username,
    userInfo,
    // 计算属性
    isLogin,
    // 方法
    setToken,
    setUserInfo,
    clearUserInfo,
  }
})
```

---

### 4.5 创建 `src/router/index.ts`

```typescript
import { createRouter, createWebHistory, type RouteRecordRaw } from 'vue-router'
import { useUserStore } from '@/stores/user'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/bookstore',
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/pages/Login/Index.vue'),
    meta: { title: '登录', requiresAuth: false },
  },
  {
    path: '/register',
    name: 'Register',
    component: () => import('@/pages/Register/Index.vue'),
    meta: { title: '注册', requiresAuth: false },
  },
  {
    path: '/bookstore',
    name: 'Bookstore',
    component: () => import('@/pages/Bookstore/Home.vue'),
    meta: { title: '书城', requiresAuth: false },
  },
  {
    path: '/profile',
    name: 'Profile',
    component: () => import('@/pages/Profile/Index.vue'),
    meta: { title: '个人中心', requiresAuth: true },
  },
]

const router = createRouter({
  history: createWebHistory(),
  routes,
})

// 路由守卫
router.beforeEach((to, from, next) => {
  const userStore = useUserStore()

  // 设置页面标题
  document.title = `${to.meta.title} - ${import.meta.env.VITE_APP_TITLE}`

  // 检查是否需要认证
  if (to.meta.requiresAuth && !userStore.isLogin) {
    next({ path: '/login', query: { redirect: to.fullPath } })
  } else if ((to.path === '/login' || to.path === '/register') && userStore.isLogin) {
    next('/')
  } else {
    next()
  }
})

export default router
```

---

### 4.6 更新 `src/main.ts`

```typescript
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import 'element-plus/dist/index.css'
import './style.css'

import App from './App.vue'
import router from './router'

const app = createApp(App)
const pinia = createPinia()

// 注册Element Plus图标
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}

app.use(pinia)
app.use(router)
app.use(ElementPlus)

app.mount('#app')
```

---

### 4.7 更新 `src/style.css`

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 全局样式 */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#app {
  width: 100%;
  min-height: 100vh;
}
```

---

## ✅ 第五步：验证配置（5分钟）

### 5.1 启动开发服务器

```bash
npm run dev
# 或
pnpm dev
```

### 5.2 检查是否成功

- ✅ 浏览器自动打开 `http://localhost:5173`
- ✅ 没有报错信息
- ✅ 控制台没有错误

### 5.3 测试代理配置

在浏览器控制台测试API请求：

```javascript
fetch('/api/v1/system/health')
  .then(res => res.json())
  .then(data => console.log('后端连接成功:', data))
  .catch(err => console.error('后端连接失败:', err))
```

---

## 📝 第六步：创建示例页面（可选）

### 6.1 创建登录页 `src/pages/Login/Index.vue`

```vue
<template>
  <div class="login-page">
    <div class="login-container">
      <h1>{{ title }}</h1>
      <el-form :model="form" :rules="rules" ref="formRef" class="login-form">
        <el-form-item prop="username">
          <el-input
            v-model="form.username"
            placeholder="用户名"
            prefix-icon="User"
            size="large"
          />
        </el-form-item>

        <el-form-item prop="password">
          <el-input
            v-model="form.password"
            type="password"
            placeholder="密码"
            prefix-icon="Lock"
            size="large"
            @keyup.enter="handleLogin"
            show-password
          />
        </el-form-item>

        <el-button
          type="primary"
          size="large"
          :loading="loading"
          @click="handleLogin"
          class="w-full"
        >
          登录
        </el-button>
      </el-form>

      <div class="mt-4 text-center text-sm">
        还没有账号？
        <router-link to="/register" class="text-primary-600 hover:underline">
          立即注册
        </router-link>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/stores/user'
import request from '@/utils/request'
import type { LoginRequest, LoginResponse } from '@/types/user'

const router = useRouter()
const route = useRoute()
const userStore = useUserStore()

const title = import.meta.env.VITE_APP_TITLE
const formRef = ref()
const loading = ref(false)

const form = reactive<LoginRequest>({
  username: '',
  password: '',
})

const rules = {
  username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],
  password: [{ required: true, message: '请输入密码', trigger: 'blur' }],
}

const handleLogin = async () => {
  try {
    await formRef.value.validate()

    loading.value = true

    // 调用登录API
    const result = await request.post<LoginResponse>('/login', form)

    // 保存Token和用户信息
    userStore.setToken(result.token)
    userStore.setUserInfo({
      id: result.userID,
      username: result.username,
      role: result.role || 'user',
      // 其他字段可以后续通过获取用户信息API补全
    } as any)

    ElMessage.success('登录成功！')

    // 跳转到之前的页面或首页
    const redirect = (route.query.redirect as string) || '/'
    router.push(redirect)
  } catch (error: any) {
    ElMessage.error(error.message || '登录失败')
  } finally {
    loading.value = false
  }
}
</script>

<style scoped>
.login-page {
  @apply min-h-screen flex items-center justify-center bg-gray-50;
}

.login-container {
  @apply bg-white p-10 rounded-lg shadow-lg w-96;
}

.login-container h1 {
  @apply text-2xl font-bold text-center mb-8 text-gray-800;
}

.login-form {
  @apply mt-6;
}
</style>
```

---

## 🎉 完成！

现在你的前端项目已经完全配置好了！

### ✅ 已完成的配置

- ✅ Vite配置（代理、别名、构建）
- ✅ Tailwind CSS配置
- ✅ TypeScript配置
- ✅ 环境变量配置
- ✅ Axios请求封装
- ✅ TypeScript类型定义
- ✅ 路由配置（含路由守卫）
- ✅ 状态管理配置
- ✅ 示例登录页

### 📋 后续开发步骤

1. **开始API对接**
   - 按照`前端API对接清单_v1.0.md`逐个对接API
   - 创建对应的页面和组件

2. **开发核心页面**
   - 书城首页、分类页、搜索页
   - 书籍详情页、阅读器页面
   - 项目列表页、编辑器页面

3. **完善公共组件**
   - BookCard、CategoryList、RankingList
   - ReaderCore、CommentList、DocumentTree

4. **集成测试**
   - 核心流程测试
   - API对接测试
   - 性能测试

---

## 📚 相关文档

- **后端API文档**: `Qingyu_backend/docs/swagger.json`
- **API对接清单**: `doc/frontend/前端开发/前端API对接清单_v1.0.md`
- **开发阶段规划**: `doc/frontend/前端开发/前端开发阶段规划_v1.0.md`
- **后端API状态**: `Qingyu_backend/后端API实现状态核查.md`

---

## 🆘 常见问题

### Q1: Tailwind样式不生效？
确保`style.css`中有Tailwind指令，并在`main.ts`中导入

### Q2: 跨域问题？
检查`vite.config.ts`中的proxy配置，确保target指向正确的后端地址

### Q3: TypeScript类型错误？
运行`npm run type-check`检查类型错误

### Q4: Element Plus组件样式问题？
确保在`main.ts`中导入了`'element-plus/dist/index.css'`

---

**文档创建**: 2025-10-27  
**版本**: v1.0  
**维护者**: 前端开发团队

🚀 **祝开发顺利！**

